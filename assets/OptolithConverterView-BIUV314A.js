import{d as B,u as J,r as h,c as _,o as T,a as V,b as d,e,f as b,t as s,g as l,w as z,v as A,n as M,F,h as D,i as v}from"./index-DwxUK2SO.js";const H={class:"container py-4"},P={class:"mb-3"},G={class:"text-muted mb-3"},K={class:"alert alert-info mb-4",role:"note"},X={class:"card shadow-sm mb-4"},Y={class:"card-body"},Z={class:"h5"},q={class:"mb-0 ps-3"},Q={class:"mb-3"},ee={for:"stat-block-input",class:"form-label"},te=["placeholder"],oe={class:"form-text"},se={key:0,class:"invalid-feedback"},ne={class:"d-flex flex-wrap gap-2 mb-4"},le=["disabled"],ae=["disabled"],re=["disabled"],ie={key:0,class:"alert alert-info",role:"status"},ce={key:1,class:"alert alert-danger",role:"alert"},ue={key:2,class:"mb-4"},de={class:"card shadow-sm"},ve={class:"card-body"},pe={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},he={class:"h5 mb-1"},_e={class:"mb-0 text-muted"},be={class:"btn-group"},me={key:0,class:"alert alert-warning",role:"alert"},fe={class:"h6 mb-2"},we={class:"mb-0 ps-3"},ge={class:"mb-3"},ye={class:"fw-semibold"},Ce={class:"bg-light border rounded p-3 small overflow-auto"},ke={open:""},xe={class:"fw-semibold"},Se={class:"bg-light border rounded p-3 small overflow-auto"},S=6e3,f="optolith-converter:last",$e=B({__name:"OptolithConverterView",setup(w){const{t:o}=J(),i=h(""),c=h("idle"),u=h(null),a=h(null),p=h(null),$=`${window.location.origin}/aventuria-impromptu/`,g=_(()=>i.value.length>S),C=_(()=>c.value==="loading"||i.value.trim().length===0||g.value),k=_(()=>!!localStorage.getItem(f)),L=_(()=>a.value?JSON.stringify(a.value.exported,null,2):""),m=_(()=>{if(!a.value)return[];const n=new Set,r=t=>t.startsWith("[Parser] ")?`${o("views.optolithConverter.warnings.prefixes.parser")} ${t.slice(9)}`:t.startsWith("[Resolver] ")?`${o("views.optolithConverter.warnings.prefixes.resolver")} ${t.slice(10)}`:t.startsWith("[Exporter] ")?`${o("views.optolithConverter.warnings.prefixes.exporter")} ${t.slice(10)}`:t;return a.value.exportedWarnings.forEach(t=>n.add(r(t))),a.value.parserWarnings.forEach(t=>n.add(r(`[Parser] ${t.section??"general"}: ${t.message}`))),a.value.resolverWarnings.forEach(t=>n.add(r(`[Resolver] ${t.section}: ${t.message}`))),Object.entries(a.value.unresolved).forEach(([t,y])=>{y.forEach(U=>n.add(r(`[Resolver] ${t}: ${U}`)))}),Array.from(n)});function E(){if(p.value)return p.value;const n=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-B3erZp__.js",import.meta.url),{type:"module"});return n.addEventListener("message",W),p.value=n,n}function W(n){const r=n.data;if(r){if(r.type==="error"){c.value="error",u.value=r.error;return}c.value="success",u.value=null,a.value=r.payload,R()}}function O(){if(C.value)return;c.value="loading",u.value=null,a.value=null,E().postMessage({type:"convert",payload:{source:i.value,baseUrl:$}})}function x(){const n=localStorage.getItem(f);if(n)try{const r=JSON.parse(n);i.value=r.input,a.value=r.payload,c.value="success",u.value=null}catch(r){console.error("Failed to restore cached result",r),localStorage.removeItem(f)}}function R(){if(!a.value)return;const n={input:i.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(f,JSON.stringify(n))}function j(){if(!a.value)return;const n=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),r=URL.createObjectURL(n),t=document.createElement("a"),y=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");t.href=r,t.download=`${y||"npc"}-optolith.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)}async function I(){if(m.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(m.value.join(`
`))}catch(n){console.error("Failed to copy warnings",n)}}function N(){i.value="",c.value="idle",u.value=null,a.value=null}return T(()=>{k.value&&x()}),V(()=>{p.value&&(p.value.terminate(),p.value=null)}),(n,r)=>(v(),d("div",H,[e("h1",P,s(l(o)("views.optolithConverter.title")),1),e("p",G,s(l(o)("views.optolithConverter.intro")),1),e("div",K,s(l(o)("views.optolithConverter.languageNote")),1),e("div",X,[e("div",Y,[e("h2",Z,s(l(o)("views.optolithConverter.usage.title")),1),e("ol",q,[e("li",null,s(l(o)("views.optolithConverter.usage.steps.paste")),1),e("li",null,s(l(o)("views.optolithConverter.usage.steps.convert")),1),e("li",null,s(l(o)("views.optolithConverter.usage.steps.review")),1),e("li",null,s(l(o)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",Q,[e("label",ee,s(l(o)("views.optolithConverter.input.label")),1),z(e("textarea",{id:"stat-block-input","onUpdate:modelValue":r[0]||(r[0]=t=>i.value=t),class:M(["form-control",{"is-invalid":g.value}]),rows:"14",placeholder:l(o)("views.optolithConverter.input.placeholder")},null,10,te),[[A,i.value]]),e("div",oe,s(l(o)("views.optolithConverter.input.help",{max:S,current:i.value.length})),1),g.value?(v(),d("div",se,s(l(o)("views.optolithConverter.input.tooLong")),1)):b("",!0)]),e("div",ne,[e("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:O},s(l(o)("views.optolithConverter.buttons.convert")),9,le),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:N,disabled:c.value==="loading"},s(l(o)("views.optolithConverter.buttons.reset")),9,ae),e("button",{type:"button",class:"btn btn-outline-success",onClick:x,disabled:!k.value||c.value==="loading"},s(l(o)("views.optolithConverter.buttons.loadLast")),9,re)]),c.value==="loading"?(v(),d("div",ie,s(l(o)("views.optolithConverter.loading")),1)):b("",!0),u.value?(v(),d("div",ce,s(u.value),1)):b("",!0),a.value?(v(),d("section",ue,[e("div",de,[e("div",ve,[e("div",pe,[e("div",null,[e("h2",he,s(a.value.exported.name),1),e("p",_e,s(l(o)("views.optolithConverter.datasetInfo",{schema:a.value.manifest.schemaVersion,checksum:a.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",be,[e("button",{type:"button",class:"btn btn-success",onClick:j},s(l(o)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:I},s(l(o)("views.optolithConverter.buttons.copyWarnings")),1)])]),m.value.length>0?(v(),d("div",me,[e("h3",fe,s(l(o)("views.optolithConverter.warnings.title")),1),e("ul",we,[(v(!0),d(F,null,D(m.value,t=>(v(),d("li",{key:t},s(t),1))),128))])])):b("",!0),e("details",ge,[e("summary",ye,s(l(o)("views.optolithConverter.normalizedHeading")),1),e("pre",Ce,s(a.value.normalizedSource),1)]),e("details",ke,[e("summary",xe,s(l(o)("views.optolithConverter.jsonHeading")),1),e("pre",Se,s(L.value),1)])])])])):b("",!0)]))}}),Le=(w,o)=>{const i=w.__vccOpts||w;for(const[c,u]of o)i[c]=u;return i},We=Le($e,[["__scopeId","data-v-7df8622e"]]);export{We as default};
