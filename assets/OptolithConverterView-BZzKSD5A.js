import{d as W,r as v,c as m,o as z,a as A,b as u,e as t,f as b,w as O,v as I,n as D,t as r,g as F,F as L,h as E,i as c}from"./index-4EyUOoJY.js";const G={class:"container py-4"},P={class:"mb-3"},q={class:"form-text"},H={key:0,class:"invalid-feedback"},K={class:"d-flex flex-wrap gap-2 mb-4"},X=["disabled"],Y=["disabled"],Q={class:"d-flex gap-2 align-items-center"},Z=["disabled"],ee=["value"],te=["disabled"],oe=["disabled"],ae={key:0,class:"alert alert-info",role:"status"},se={key:1,class:"alert alert-danger",role:"alert"},le={key:2,class:"mb-4"},ne={class:"card shadow-sm"},re={class:"card-body"},ie={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},ue={class:"h5 mb-1"},ce={class:"mb-0 text-muted"},de={key:0,class:"alert alert-warning",role:"alert"},ve={class:"mb-0 ps-3"},pe={class:"mb-3"},me={class:"bg-light border rounded p-3 small overflow-auto"},be={open:""},ge={class:"bg-light border rounded p-3 small overflow-auto"},R=6e3,h="optolith-converter:last",fe=W({__name:"OptolithConverterView",setup(_){const g=[{slug:"notia-botero-montez",label:"Notia Botero-Montez"},{slug:"gerion-mtoto",label:"Gerion Mtoto"},{slug:"schamane",label:"Schamane"}],n=v(""),p=v(g[0]?.slug??"notia-botero-montez"),l=v("idle"),i=v(null),a=v(null),d=v(null),k=`${window.location.origin}/aventuria-impromptu/`,y=m(()=>n.value.length>R),S=m(()=>l.value==="loading"||n.value.trim().length===0||y.value),x=m(()=>!!localStorage.getItem(h)),N=m(()=>a.value?JSON.stringify(a.value.exported,null,2):""),f=m(()=>{if(!a.value)return[];const o=new Set;return a.value.exported.warnings.forEach(e=>o.add(e)),a.value.parserWarnings.forEach(e=>o.add(`[Parser] ${e.section??"general"}: ${e.message}`)),a.value.resolverWarnings.forEach(e=>o.add(`[Resolver] ${e.section}: ${e.message}`)),Object.entries(a.value.unresolved).forEach(([e,s])=>{s.forEach(w=>o.add(`[Resolver] ${e}: ${w}`))}),Array.from(o)});function $(){if(d.value)return d.value;const o=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-qu4AVLbk.js",import.meta.url),{type:"module"});return o.addEventListener("message",U),d.value=o,o}function U(o){const e=o.data;if(e){if(e.type==="error"){l.value="error",i.value=e.error;return}l.value="success",i.value=null,a.value=e.payload,j()}}function J(){if(S.value)return;l.value="loading",i.value=null,a.value=null,$().postMessage({type:"convert",payload:{source:n.value,baseUrl:k}})}async function M(o){if(o){l.value="idle",i.value=null,a.value=null;try{const e=await fetch(new URL(`samples/stat-blocks/${o}.txt`,k).toString());if(!e.ok)throw new Error(`Sample ${o} not available`);n.value=await e.text()}catch(e){i.value=e instanceof Error?e.message:String(e),l.value="error"}}}function C(){const o=localStorage.getItem(h);if(o)try{const e=JSON.parse(o);n.value=e.input,a.value=e.payload,l.value="success",i.value=null}catch(e){console.error("Failed to restore cached result",e),localStorage.removeItem(h)}}function j(){if(!a.value)return;const o={input:n.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(h,JSON.stringify(o))}function B(){if(!a.value)return;const o=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),e=URL.createObjectURL(o),s=document.createElement("a"),w=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");s.href=e,s.download=`${w||"npc"}-optolith.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)}async function T(){if(f.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(f.value.join(`
`))}catch(o){console.error("Failed to copy warnings",o)}}function V(){n.value="",l.value="idle",i.value=null,a.value=null}return z(()=>{x.value&&C()}),A(()=>{d.value&&(d.value.terminate(),d.value=null)}),(o,e)=>(c(),u("div",G,[e[7]||(e[7]=t("h1",{class:"mb-3"},"Optolith Converter",-1)),e[8]||(e[8]=t("p",{class:"text-muted"}," Paste a single German DSA5 stat block to generate an Optolith-compatible JSON. The converter runs locally – no data leaves your browser. ",-1)),t("div",P,[e[3]||(e[3]=t("label",{for:"stat-block-input",class:"form-label"},"Stat block",-1)),O(t("textarea",{id:"stat-block-input","onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),class:D(["form-control",{"is-invalid":y.value}]),rows:"14",placeholder:"Paste the stat block here"},null,2),[[I,n.value]]),t("div",q," Maximum length "+r(R)+" characters. Current: "+r(n.value.length)+". ",1),y.value?(c(),u("div",H," The stat block exceeds the supported length. ")):b("",!0)]),t("div",K,[t("button",{type:"button",class:"btn btn-primary",disabled:S.value,onClick:J}," Convert Stat Block ",8,X),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:V,disabled:l.value==="loading"}," Reset ",8,Y),t("div",Q,[O(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),class:"form-select form-select-sm",disabled:l.value==="loading"},[(c(),u(L,null,E(g,s=>t("option",{key:s.slug,value:s.slug},r(s.label),9,ee)),64))],8,Z),[[F,p.value]]),t("button",{type:"button",class:"btn btn-outline-info",disabled:l.value==="loading",onClick:e[2]||(e[2]=s=>M(p.value))}," Load Sample ",8,te)]),t("button",{type:"button",class:"btn btn-outline-success",onClick:C,disabled:!x.value||l.value==="loading"}," Load Last Result ",8,oe)]),l.value==="loading"?(c(),u("div",ae," Converting… please wait. ")):b("",!0),i.value?(c(),u("div",se,r(i.value),1)):b("",!0),a.value?(c(),u("section",le,[t("div",ne,[t("div",re,[t("div",ie,[t("div",null,[t("h2",ue,r(a.value.exported.name),1),t("p",ce," Dataset schema "+r(a.value.manifest.schemaVersion)+" · Source checksum "+r(a.value.manifest.sourceChecksum.slice(0,12))+"… ",1)]),t("div",{class:"btn-group"},[t("button",{type:"button",class:"btn btn-success",onClick:B}," Download JSON "),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:T}," Copy warnings ")])]),f.value.length>0?(c(),u("div",de,[e[4]||(e[4]=t("h3",{class:"h6 mb-2"},"Warnings",-1)),t("ul",ve,[(c(!0),u(L,null,E(f.value,s=>(c(),u("li",{key:s},r(s),1))),128))])])):b("",!0),t("details",pe,[e[5]||(e[5]=t("summary",{class:"fw-semibold"},"Normalized stat block",-1)),t("pre",me,r(a.value.normalizedSource),1)]),t("details",be,[e[6]||(e[6]=t("summary",{class:"fw-semibold"},"Optolith JSON preview",-1)),t("pre",ge,r(N.value),1)])])])])):b("",!0)]))}}),he=(_,g)=>{const n=_.__vccOpts||_;for(const[p,l]of g)n[p]=l;return n},ye=he(fe,[["__scopeId","data-v-e30032b5"]]);export{ye as default};
