import{d as J,u as T,r as _,c as b,o as V,a as z,b as v,e,f as m,t as o,g as n,w as A,v as D,n as M,F,h as H,i as p}from"./index-DZAksuG3.js";const P={class:"container py-4"},G={class:"mb-3"},K={class:"text-muted mb-3"},Q={class:"alert alert-info mb-4",role:"note"},X={class:"card shadow-sm mb-4"},Y={class:"card-body"},Z={class:"h5"},q={class:"mb-0 ps-3"},ee={class:"mb-3"},te={for:"stat-block-input",class:"form-label"},oe=["placeholder"],se={class:"form-text"},ne={key:0,class:"invalid-feedback"},ae={class:"d-flex flex-wrap gap-2 mb-4"},re=["disabled"],le=["disabled"],ie=["disabled"],ce={key:0,class:"alert alert-info",role:"status"},ue={key:1,class:"alert alert-danger",role:"alert"},de={key:2,class:"mb-4"},ve={class:"card shadow-sm"},pe={class:"card-body"},he={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},_e={class:"h5 mb-1"},be={class:"mb-0 text-muted"},me={class:"btn-group"},fe={key:0,class:"alert alert-warning",role:"alert"},ge={class:"h6 mb-2"},we={class:"mb-0 ps-3"},ye={class:"mb-3"},Ce={class:"fw-semibold"},xe={class:"bg-light border rounded p-3 small overflow-auto"},ke={open:""},We={class:"fw-semibold"},Se={class:"bg-light border rounded p-3 small overflow-auto"},W=6e3,g="optolith-converter:last",$e=J({__name:"OptolithConverterView",setup(w){const{t}=T(),i=_(""),c=_("idle"),d=_(null),a=_(null),h=_(null),S=`${window.location.origin}/aventuria-impromptu/`,y=b(()=>i.value.length>W),C=b(()=>c.value==="loading"||i.value.trim().length===0||y.value),x=b(()=>!!localStorage.getItem(g)),$=b(()=>a.value?JSON.stringify(a.value.exported,null,2):""),f=b(()=>{if(!a.value)return[];const s=new Set,r=l=>l.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${l.slice(9)}`:l.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${l.slice(10)}`:l.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${l.slice(10)}`:l;return(a.value.exportedWarnings??[]).forEach(l=>s.add(r(l))),(a.value.parserWarnings??[]).forEach(l=>s.add(r(`[Parser] ${l.section??"general"}: ${l.message}`))),(a.value.resolverWarnings??[]).forEach(l=>s.add(r(`[Resolver] ${l.section}: ${l.message}`))),Object.entries(a.value.unresolved??{}).forEach(([l,U])=>{U.forEach(B=>s.add(r(`[Resolver] ${l}: ${B}`)))}),Array.from(s)});function L(){if(h.value)return h.value;const s=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return s.addEventListener("message",E),h.value=s,s}function E(s){const r=s.data;if(r){if(r.type==="error"){c.value="error",d.value=r.error;return}c.value="success",d.value=null,a.value=r.payload,R()}}function O(){if(C.value)return;c.value="loading",d.value=null,a.value=null,L().postMessage({type:"convert",payload:{source:i.value,baseUrl:S}})}function k(){const s=localStorage.getItem(g);if(s)try{const r=JSON.parse(s);i.value=r.input,a.value={...r.payload,exportedWarnings:r.payload.exportedWarnings??[]},c.value="success",d.value=null}catch(r){console.error("Failed to restore cached result",r),localStorage.removeItem(g)}}function R(){if(!a.value)return;const s={input:i.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(g,JSON.stringify(s))}function j(){if(!a.value)return;const s=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),u=document.createElement("a"),l=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");u.href=r,u.download=`${l||"npc"}-optolith.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(r)}async function I(){if(f.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(f.value.join(`
`))}catch(s){console.error("Failed to copy warnings",s)}}function N(){i.value="",c.value="idle",d.value=null,a.value=null}return V(()=>{x.value&&k()}),z(()=>{h.value&&(h.value.terminate(),h.value=null)}),(s,r)=>(p(),v("div",P,[e("h1",G,o(n(t)("views.optolithConverter.title")),1),e("p",K,o(n(t)("views.optolithConverter.intro")),1),e("div",Q,o(n(t)("views.optolithConverter.languageNote")),1),e("div",X,[e("div",Y,[e("h2",Z,o(n(t)("views.optolithConverter.usage.title")),1),e("ol",q,[e("li",null,o(n(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,o(n(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,o(n(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,o(n(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",ee,[e("label",te,o(n(t)("views.optolithConverter.input.label")),1),A(e("textarea",{id:"stat-block-input","onUpdate:modelValue":r[0]||(r[0]=u=>i.value=u),class:M(["form-control",{"is-invalid":y.value}]),rows:"14",placeholder:n(t)("views.optolithConverter.input.placeholder")},null,10,oe),[[D,i.value]]),e("div",se,o(n(t)("views.optolithConverter.input.help",{max:W,current:i.value.length})),1),y.value?(p(),v("div",ne,o(n(t)("views.optolithConverter.input.tooLong")),1)):m("",!0)]),e("div",ae,[e("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:O},o(n(t)("views.optolithConverter.buttons.convert")),9,re),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:N,disabled:c.value==="loading"},o(n(t)("views.optolithConverter.buttons.reset")),9,le),e("button",{type:"button",class:"btn btn-outline-success",onClick:k,disabled:!x.value||c.value==="loading"},o(n(t)("views.optolithConverter.buttons.loadLast")),9,ie)]),c.value==="loading"?(p(),v("div",ce,o(n(t)("views.optolithConverter.loading")),1)):m("",!0),d.value?(p(),v("div",ue,o(d.value),1)):m("",!0),a.value?(p(),v("section",de,[e("div",ve,[e("div",pe,[e("div",he,[e("div",null,[e("h2",_e,o(a.value.exported.name),1),e("p",be,o(n(t)("views.optolithConverter.datasetInfo",{schema:a.value.manifest.schemaVersion,checksum:a.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",me,[e("button",{type:"button",class:"btn btn-success",onClick:j},o(n(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:I},o(n(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),f.value.length>0?(p(),v("div",fe,[e("h3",ge,o(n(t)("views.optolithConverter.warnings.title")),1),e("ul",we,[(p(!0),v(F,null,H(f.value,u=>(p(),v("li",{key:u},o(u),1))),128))])])):m("",!0),e("details",ye,[e("summary",Ce,o(n(t)("views.optolithConverter.normalizedHeading")),1),e("pre",xe,o(a.value.normalizedSource),1)]),e("details",ke,[e("summary",We,o(n(t)("views.optolithConverter.jsonHeading")),1),e("pre",Se,o($.value),1)])])])])):m("",!0)]))}}),Le=(w,t)=>{const i=w.__vccOpts||w;for(const[c,d]of t)i[c]=d;return i},Oe=Le($e,[["__scopeId","data-v-c47ca625"]]);export{Oe as default};
