import{d as B,u as J,r as _,c as b,o as z,a as A,b as v,e,f as m,t as o,g as s,h as W,w as D,v as M,n as F,F as H,i as P,j as p}from"./index-B0hxJHOe.js";const G={class:"container py-4"},K={class:"mb-3"},Q={class:"text-muted mb-3"},X={class:"mb-3"},Y={href:"https://roll20.net",target:"_blank",rel:"noopener noreferrer"},Z={class:"alert alert-info mb-4",role:"note"},q={class:"card shadow-sm mb-4"},ee={class:"card-body"},te={class:"h5"},oe={class:"mb-0 ps-3"},se={class:"mb-3"},ne={for:"stat-block-input",class:"form-label"},re=["placeholder"],le={class:"form-text"},ae={key:0,class:"invalid-feedback"},ie={class:"d-flex flex-wrap gap-2 mb-4"},ce=["disabled"],ue=["disabled"],de=["disabled"],ve={key:0,class:"alert alert-info",role:"status"},pe={key:1,class:"alert alert-danger",role:"alert"},he={key:2,class:"mb-4"},_e={class:"card shadow-sm"},be={class:"card-body"},me={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},fe={class:"h5 mb-1"},ge={class:"mb-0 text-muted"},we={class:"btn-group"},ye={key:0,class:"alert alert-warning",role:"alert"},Ce={class:"h6 mb-2"},xe={class:"mb-0 ps-3"},ke={class:"mb-3"},We={class:"fw-semibold"},Se={class:"bg-light border rounded p-3 small overflow-auto"},$e={open:""},Le={class:"fw-semibold"},Ee={class:"bg-light border rounded p-3 small overflow-auto"},S=6e3,g="optolith-converter:last",Ne=B({__name:"OptolithConverterView",setup(w){const{t}=J(),i=_(""),c=_("idle"),d=_(null),r=_(null),h=_(null),$=`${window.location.origin}/aventuria-impromptu/`,y=b(()=>i.value.length>S),C=b(()=>c.value==="loading"||i.value.trim().length===0||y.value),x=b(()=>!!localStorage.getItem(g)),L=b(()=>r.value?JSON.stringify(r.value.exported,null,2):""),f=b(()=>{if(!r.value)return[];const n=new Set,l=a=>a.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${a.slice(9)}`:a.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${a.slice(10)}`:a.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${a.slice(10)}`:a;return(r.value.exportedWarnings??[]).forEach(a=>n.add(l(a))),(r.value.parserWarnings??[]).forEach(a=>n.add(l(`[Parser] ${a.section??"general"}: ${a.message}`))),(r.value.resolverWarnings??[]).forEach(a=>n.add(l(`[Resolver] ${a.section}: ${a.message}`))),Object.entries(r.value.unresolved??{}).forEach(([a,U])=>{U.forEach(V=>n.add(l(`[Resolver] ${a}: ${V}`)))}),Array.from(n)});function E(){if(h.value)return h.value;const n=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return n.addEventListener("message",N),h.value=n,n}function N(n){const l=n.data;if(l){if(l.type==="error"){c.value="error",d.value=l.error;return}c.value="success",d.value=null,r.value=l.payload,R()}}function O(){if(C.value)return;c.value="loading",d.value=null,r.value=null,E().postMessage({type:"convert",payload:{source:i.value,baseUrl:$}})}function k(){const n=localStorage.getItem(g);if(n)try{const l=JSON.parse(n);i.value=l.input,r.value={...l.payload,exportedWarnings:l.payload.exportedWarnings??[]},c.value="success",d.value=null}catch(l){console.error("Failed to restore cached result",l),localStorage.removeItem(g)}}function R(){if(!r.value)return;const n={input:i.value,payload:r.value,storedAt:new Date().toISOString()};localStorage.setItem(g,JSON.stringify(n))}function j(){if(!r.value)return;const n=new Blob([JSON.stringify(r.value.exported,null,2)],{type:"application/json"}),l=URL.createObjectURL(n),u=document.createElement("a"),a=r.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");u.href=l,u.download=`${a||"npc"}-optolith.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l)}async function I(){if(f.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(f.value.join(`
`))}catch(n){console.error("Failed to copy warnings",n)}}function T(){i.value="",c.value="idle",d.value=null,r.value=null}return z(()=>{x.value&&k()}),A(()=>{h.value&&(h.value.terminate(),h.value=null)}),(n,l)=>(p(),v("div",G,[e("h1",K,o(s(t)("views.optolithConverter.title")),1),e("p",Q,o(s(t)("views.optolithConverter.intro")),1),e("p",X,[W(o(s(t)("views.optolithConverter.roll20Note.prefix"))+" ",1),e("a",Y,o(s(t)("views.optolithConverter.roll20Note.linkText")),1),W(" "+o(s(t)("views.optolithConverter.roll20Note.suffix")),1)]),e("div",Z,o(s(t)("views.optolithConverter.languageNote")),1),e("div",q,[e("div",ee,[e("h2",te,o(s(t)("views.optolithConverter.usage.title")),1),e("ol",oe,[e("li",null,o(s(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",se,[e("label",ne,o(s(t)("views.optolithConverter.input.label")),1),D(e("textarea",{id:"stat-block-input","onUpdate:modelValue":l[0]||(l[0]=u=>i.value=u),class:F(["form-control",{"is-invalid":y.value}]),rows:"14",placeholder:s(t)("views.optolithConverter.input.placeholder")},null,10,re),[[M,i.value]]),e("div",le,o(s(t)("views.optolithConverter.input.help",{max:S,current:i.value.length})),1),y.value?(p(),v("div",ae,o(s(t)("views.optolithConverter.input.tooLong")),1)):m("",!0)]),e("div",ie,[e("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:O},o(s(t)("views.optolithConverter.buttons.convert")),9,ce),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:T,disabled:c.value==="loading"},o(s(t)("views.optolithConverter.buttons.reset")),9,ue),e("button",{type:"button",class:"btn btn-outline-success",onClick:k,disabled:!x.value||c.value==="loading"},o(s(t)("views.optolithConverter.buttons.loadLast")),9,de)]),c.value==="loading"?(p(),v("div",ve,o(s(t)("views.optolithConverter.loading")),1)):m("",!0),d.value?(p(),v("div",pe,o(d.value),1)):m("",!0),r.value?(p(),v("section",he,[e("div",_e,[e("div",be,[e("div",me,[e("div",null,[e("h2",fe,o(r.value.exported.name),1),e("p",ge,o(s(t)("views.optolithConverter.datasetInfo",{schema:r.value.manifest.schemaVersion,checksum:r.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",we,[e("button",{type:"button",class:"btn btn-success",onClick:j},o(s(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:I},o(s(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),f.value.length>0?(p(),v("div",ye,[e("h3",Ce,o(s(t)("views.optolithConverter.warnings.title")),1),e("ul",xe,[(p(!0),v(H,null,P(f.value,u=>(p(),v("li",{key:u},o(u),1))),128))])])):m("",!0),e("details",ke,[e("summary",We,o(s(t)("views.optolithConverter.normalizedHeading")),1),e("pre",Se,o(r.value.normalizedSource),1)]),e("details",$e,[e("summary",Le,o(s(t)("views.optolithConverter.jsonHeading")),1),e("pre",Ee,o(L.value),1)])])])])):m("",!0)]))}}),Oe=(w,t)=>{const i=w.__vccOpts||w;for(const[c,d]of t)i[c]=d;return i},je=Oe(Ne,[["__scopeId","data-v-22226aba"]]);export{je as default};
