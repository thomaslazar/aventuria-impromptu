import{d as k,u as H,r as b,c as v,o as x,a as S,b as u,e,f as p,t as l,g as s,w as L,v as Q,n as U,F as T,h as j,i as I}from"./index-Ln3n9kjM.js";const E={class:"container py-4"},O={class:"mb-3"},D={class:"text-muted mb-3"},M={class:"alert alert-info mb-4",role:"note"},$={class:"card shadow-sm mb-4"},P={class:"card-body"},q={class:"h5"},ee={class:"mb-0 ps-3"},te={class:"mb-3"},le={for:"stat-block-input",class:"form-label"},oe=["placeholder"],se={class:"form-text"},ae={key:0,class:"invalid-feedback"},ne={class:"d-flex flex-wrap gap-2 mb-4"},ce=["disabled"],ie=["disabled"],re=["disabled"],de={key:0,class:"alert alert-info",role:"status"},ge={key:1,class:"alert alert-danger",role:"alert"},ue={key:2,class:"mb-4"},Ie={class:"card shadow-sm"},Ce={class:"card-body"},be={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},ve={class:"h5 mb-1"},pe={class:"mb-0 text-muted"},me={class:"btn-group"},he={key:0,class:"alert alert-warning",role:"alert"},Ze={class:"h6 mb-2"},We={class:"mb-0 ps-3"},Ae={class:"mb-3"},Ge={class:"fw-semibold"},we={class:"bg-light border rounded p-3 small overflow-auto"},Ne={open:""},Ve={class:"fw-semibold"},Ye={class:"bg-light border rounded p-3 small overflow-auto"},N=6e3,h="optolith-converter:last",Xe=k({__name:"OptolithConverterView",setup(Z){const{t}=H(),i=b(""),r=b("idle"),g=b(null),a=b(null),C=b(null),V=`${window.location.origin}/aventuria-impromptu/`,Y=new URL("/aventuria-impromptu/",window.location.href).toString().replace(/\/?$/,"/"),W=v(()=>i.value.length>N),A=v(()=>r.value==="loading"||i.value.trim().length===0||W.value),G=v(()=>!!localStorage.getItem(h)),X=v(()=>a.value?JSON.stringify(a.value.exported,null,2):""),m=v(()=>{if(!a.value)return[];const n=new Set,o=c=>c.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${c.slice(9)}`:c.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${c.slice(10)}`:c.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${c.slice(10)}`:c;return(a.value.exportedWarnings??[]).forEach(c=>n.add(o(c))),(a.value.parserWarnings??[]).forEach(c=>n.add(o(`[Parser] ${c.section??"general"}: ${c.message}`))),(a.value.resolverWarnings??[]).forEach(c=>n.add(o(`[Resolver] ${c.section}: ${c.message}`))),Object.entries(a.value.unresolved??{}).forEach(([c,f])=>{f.forEach(K=>n.add(o(`[Resolver] ${c}: ${K}`)))}),Array.from(n)});function y(){if(C.value)return C.value;const n=new URL("data:video/mp2t;base64,aW1wb3J0IHR5cGUgeyBPcHRvbGl0aERhdGFzZXQgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9kYXRhc2V0IjsKaW1wb3J0IHsgY3JlYXRlRGF0YXNldExvb2t1cHMgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9kYXRhc2V0IjsKaW1wb3J0IHsgZXhwb3J0VG9PcHRvbGl0aENoYXJhY3RlciB9IGZyb20gIi4uL3NlcnZpY2VzL29wdG9saXRoL2V4cG9ydGVyIjsKaW1wb3J0IHsgcmVzb2x2ZVN0YXRCbG9jayB9IGZyb20gIi4uL3NlcnZpY2VzL29wdG9saXRoL3Jlc29sdmVyIjsKaW1wb3J0IHsgcGFyc2VTdGF0QmxvY2sgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9zdGF0QmxvY2tQYXJzZXIiOwppbXBvcnQgdHlwZSB7CiAgQ29udmVyc2lvbkVycm9yTWVzc2FnZSwKICBDb252ZXJzaW9uUmVxdWVzdE1lc3NhZ2UsCiAgQ29udmVyc2lvblN1Y2Nlc3NNZXNzYWdlLAp9IGZyb20gIi4uL3R5cGVzL29wdG9saXRoL2NvbnZlcnRlciI7CgpsZXQgY2FjaGVkRGF0YXNldDogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlRGF0YXNldExvb2t1cHM+IHwgdW5kZWZpbmVkOwpsZXQgY2FjaGVkTWFuaWZlc3RQYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQ7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoCiAgIm1lc3NhZ2UiLAogIGFzeW5jIChldmVudDogTWVzc2FnZUV2ZW50PENvbnZlcnNpb25SZXF1ZXN0TWVzc2FnZT4pID0+IHsKICAgIGNvbnN0IG1lc3NhZ2UgPSBldmVudC5kYXRhOwogICAgaWYgKCFtZXNzYWdlIHx8IG1lc3NhZ2UudHlwZSAhPT0gImNvbnZlcnQiKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICBjb25zdCBkYXRhc2V0ID0gYXdhaXQgbG9hZERhdGFzZXQobWVzc2FnZS5wYXlsb2FkLmJhc2VVcmwpOwogICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVN0YXRCbG9jayhtZXNzYWdlLnBheWxvYWQuc291cmNlKTsKICAgICAgY29uc3QgcmVzb2x2ZWQgPSByZXNvbHZlU3RhdEJsb2NrKHBhcnNlZC5tb2RlbCwgZGF0YXNldCk7CiAgICAgIGNvbnN0IHsgaGVybywgd2FybmluZ3M6IGV4cG9ydGVkV2FybmluZ3MgfSA9IGV4cG9ydFRvT3B0b2xpdGhDaGFyYWN0ZXIoewogICAgICAgIGRhdGFzZXQsCiAgICAgICAgcGFyc2VkLAogICAgICAgIHJlc29sdmVkLAogICAgICB9KTsKCiAgICAgIGNvbnN0IHJlc3BvbnNlOiBDb252ZXJzaW9uU3VjY2Vzc01lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogInJlc3VsdCIsCiAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgZXhwb3J0ZWQ6IGhlcm8sCiAgICAgICAgICBleHBvcnRlZFdhcm5pbmdzLAogICAgICAgICAgbWFuaWZlc3Q6IGRhdGFzZXQubWFuaWZlc3QsCiAgICAgICAgICBub3JtYWxpemVkU291cmNlOiBwYXJzZWQubm9ybWFsaXplZFNvdXJjZSwKICAgICAgICAgIHBhcnNlcldhcm5pbmdzOiBwYXJzZWQud2FybmluZ3MsCiAgICAgICAgICByZXNvbHZlcldhcm5pbmdzOiByZXNvbHZlZC53YXJuaW5ncywKICAgICAgICAgIHVucmVzb2x2ZWQ6IHJlc29sdmVkLnVucmVzb2x2ZWQsCiAgICAgICAgfSwKICAgICAgfTsKCiAgICAgIHBvc3RNZXNzYWdlKHJlc3BvbnNlKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlOiBDb252ZXJzaW9uRXJyb3JNZXNzYWdlID0gewogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSwKICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UocmVzcG9uc2UpOwogICAgfQogIH0sCik7Cgphc3luYyBmdW5jdGlvbiBsb2FkRGF0YXNldChiYXNlVXJsOiBzdHJpbmcpIHsKICBjb25zdCBtYW5pZmVzdFVybCA9IG5ldyBVUkwoCiAgICAiZGF0YS9vcHRvbGl0aC9tYW5pZmVzdC5qc29uIiwKICAgIGJhc2VVcmwsCiAgKS50b1N0cmluZygpOwogIGlmIChjYWNoZWREYXRhc2V0ICYmIGNhY2hlZE1hbmlmZXN0UGF0aCA9PT0gbWFuaWZlc3RVcmwpIHsKICAgIHJldHVybiBjYWNoZWREYXRhc2V0OwogIH0KCiAgY29uc3QgbWFuaWZlc3RSZXNwb25zZSA9IGF3YWl0IGZldGNoKG1hbmlmZXN0VXJsKTsKICBpZiAoIW1hbmlmZXN0UmVzcG9uc2Uub2spIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgYE1hbmlmZXN0IGtvbm50ZSBuaWNodCBnZWxhZGVuIHdlcmRlbiAoJHttYW5pZmVzdFJlc3BvbnNlLnN0YXR1c30pYCwKICAgICk7CiAgfQogIGNvbnN0IG1hbmlmZXN0ID0KICAgIChhd2FpdCBtYW5pZmVzdFJlc3BvbnNlLmpzb24oKSkgYXMgT3B0b2xpdGhEYXRhc2V0WyJtYW5pZmVzdCJdOwoKICBjb25zdCByZWFkU2VjdGlvbiA9IGFzeW5jIChmaWxlOiBzdHJpbmcpID0+IHsKICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYGRhdGEvb3B0b2xpdGgvJHtmaWxlfWAsIGJhc2VVcmwpLnRvU3RyaW5nKCk7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICBgRGF0ZW5zYXR6ICR7ZmlsZX0ga29ubnRlIG5pY2h0IGdlbGFkZW4gd2VyZGVuICgke3Jlc3BvbnNlLnN0YXR1c30pYCwKICAgICAgKTsKICAgIH0KICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgfTsKCiAgY29uc3QgZGF0YXNldDogT3B0b2xpdGhEYXRhc2V0ID0gewogICAgbWFuaWZlc3QsCiAgICBhZHZhbnRhZ2VzOiBhd2FpdCByZWFkU2VjdGlvbihmaW5kU2VjdGlvbkZpbGUobWFuaWZlc3QsICJhZHZhbnRhZ2VzIikpLAogICAgZGlzYWR2YW50YWdlczogYXdhaXQgcmVhZFNlY3Rpb24oCiAgICAgIGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImRpc2FkdmFudGFnZXMiKSwKICAgICksCiAgICBzcGVjaWFsQWJpbGl0aWVzOiBhd2FpdCByZWFkU2VjdGlvbigKICAgICAgZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAic3BlY2lhbEFiaWxpdGllcyIpLAogICAgKSwKICAgIHNraWxsczogYXdhaXQgcmVhZFNlY3Rpb24oZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAic2tpbGxzIikpLAogICAgY29tYmF0VGVjaG5pcXVlczogYXdhaXQgcmVhZFNlY3Rpb24oCiAgICAgIGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImNvbWJhdFRlY2huaXF1ZXMiKSwKICAgICksCiAgICBzcGVsbHM6IGF3YWl0IHJlYWRTZWN0aW9uKGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgInNwZWxscyIpKSwKICAgIGxpdHVyZ2llczogYXdhaXQgcmVhZFNlY3Rpb24oZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAibGl0dXJnaWVzIikpLAogICAgYmxlc3NpbmdzOiBhd2FpdCByZWFkU2VjdGlvbihmaW5kU2VjdGlvbkZpbGUobWFuaWZlc3QsICJibGVzc2luZ3MiKSksCiAgICBlcXVpcG1lbnQ6IGF3YWl0IHJlYWRTZWN0aW9uKGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImVxdWlwbWVudCIpKSwKICB9OwoKICBjYWNoZWREYXRhc2V0ID0gY3JlYXRlRGF0YXNldExvb2t1cHMoZGF0YXNldCk7CiAgY2FjaGVkTWFuaWZlc3RQYXRoID0gbWFuaWZlc3RVcmw7CiAgcmV0dXJuIGNhY2hlZERhdGFzZXQ7Cn0KCmZ1bmN0aW9uIGZpbmRTZWN0aW9uRmlsZSgKICBtYW5pZmVzdDogT3B0b2xpdGhEYXRhc2V0WyJtYW5pZmVzdCJdLAogIGtleTogc3RyaW5nLAopOiBzdHJpbmcgewogIGNvbnN0IHNlY3Rpb24gPSBtYW5pZmVzdC5zZWN0aW9ucy5maW5kKChjYW5kaWRhdGUpID0+IGNhbmRpZGF0ZS5rZXkgPT09IGtleSk7CiAgaWYgKCFzZWN0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYE1hbmlmZXN0YWJzY2huaXR0IGZlaGx0OiAke2tleX1gKTsKICB9CiAgcmV0dXJuIHNlY3Rpb24uZmlsZTsKfQo=",import.meta.url);new URL(n.toString(),Y);const o=new Worker(n,{type:"module"});return o.addEventListener("message",R),C.value=o,o}function R(n){const o=n.data;if(o){if(o.type==="error"){r.value="error",g.value=o.error;return}r.value="success",g.value=null,a.value=o.payload,z()}}function B(){if(A.value)return;r.value="loading",g.value=null,a.value=null,y().postMessage({type:"convert",payload:{source:i.value,baseUrl:V}})}function w(){const n=localStorage.getItem(h);if(n)try{const o=JSON.parse(n);i.value=o.input,a.value={...o.payload,exportedWarnings:o.payload.exportedWarnings??[]},r.value="success",g.value=null}catch(o){console.error("Failed to restore cached result",o),localStorage.removeItem(h)}}function z(){if(!a.value)return;const n={input:i.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(h,JSON.stringify(n))}function F(){if(!a.value)return;const n=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),d=document.createElement("a"),c=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");d.href=o,d.download=`${c||"npc"}-optolith.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(o)}async function _(){if(m.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(m.value.join(`
`))}catch(n){console.error("Failed to copy warnings",n)}}function J(){i.value="",r.value="idle",g.value=null,a.value=null}return x(()=>{G.value&&w()}),S(()=>{C.value&&(C.value.terminate(),C.value=null)}),(n,o)=>(I(),u("div",E,[e("h1",O,l(s(t)("views.optolithConverter.title")),1),e("p",D,l(s(t)("views.optolithConverter.intro")),1),e("div",M,l(s(t)("views.optolithConverter.languageNote")),1),e("div",$,[e("div",P,[e("h2",q,l(s(t)("views.optolithConverter.usage.title")),1),e("ol",ee,[e("li",null,l(s(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,l(s(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,l(s(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,l(s(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",te,[e("label",le,l(s(t)("views.optolithConverter.input.label")),1),L(e("textarea",{id:"stat-block-input","onUpdate:modelValue":o[0]||(o[0]=d=>i.value=d),class:U(["form-control",{"is-invalid":W.value}]),rows:"14",placeholder:s(t)("views.optolithConverter.input.placeholder")},null,10,oe),[[Q,i.value]]),e("div",se,l(s(t)("views.optolithConverter.input.help",{max:N,current:i.value.length})),1),W.value?(I(),u("div",ae,l(s(t)("views.optolithConverter.input.tooLong")),1)):p("",!0)]),e("div",ne,[e("button",{type:"button",class:"btn btn-primary",disabled:A.value,onClick:B},l(s(t)("views.optolithConverter.buttons.convert")),9,ce),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:J,disabled:r.value==="loading"},l(s(t)("views.optolithConverter.buttons.reset")),9,ie),e("button",{type:"button",class:"btn btn-outline-success",onClick:w,disabled:!G.value||r.value==="loading"},l(s(t)("views.optolithConverter.buttons.loadLast")),9,re)]),r.value==="loading"?(I(),u("div",de,l(s(t)("views.optolithConverter.loading")),1)):p("",!0),g.value?(I(),u("div",ge,l(g.value),1)):p("",!0),a.value?(I(),u("section",ue,[e("div",Ie,[e("div",Ce,[e("div",be,[e("div",null,[e("h2",ve,l(a.value.exported.name),1),e("p",pe,l(s(t)("views.optolithConverter.datasetInfo",{schema:a.value.manifest.schemaVersion,checksum:a.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",me,[e("button",{type:"button",class:"btn btn-success",onClick:F},l(s(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:_},l(s(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),m.value.length>0?(I(),u("div",he,[e("h3",Ze,l(s(t)("views.optolithConverter.warnings.title")),1),e("ul",We,[(I(!0),u(T,null,j(m.value,d=>(I(),u("li",{key:d},l(d),1))),128))])])):p("",!0),e("details",Ae,[e("summary",Ge,l(s(t)("views.optolithConverter.normalizedHeading")),1),e("pre",we,l(a.value.normalizedSource),1)]),e("details",Ne,[e("summary",Ve,l(s(t)("views.optolithConverter.jsonHeading")),1),e("pre",Ye,l(X.value),1)])])])])):p("",!0)]))}}),ye=(Z,t)=>{const i=Z.__vccOpts||Z;for(const[r,g]of t)i[r]=g;return i},Be=ye(Xe,[["__scopeId","data-v-31293a67"]]);export{Be as default};
