import{d as B,u as J,r as _,c as g,o as z,a as A,b as d,e as t,f,t as o,g as l,h as W,w as D,v as M,n as F,F as H,i as P,j as p}from"./index-DopeUIL-.js";const G={class:"aventuria-section optolith-view"},K={class:"aventuria-section-header"},Q={class:"aventuria-section-title"},X={class:"aventuria-section-intro optolith-intro"},Y={class:"aventuria-card aventuria-card--table optolith-card"},Z={class:"optolith-callout optolith-callout--accent",role:"note"},q={class:"optolith-roll20__link",href:"https://roll20.net",target:"_blank",rel:"noopener noreferrer"},tt={class:"optolith-usage"},et={class:"aventuria-card-title optolith-usage__title"},ot={class:"optolith-usage__list"},lt={class:"optolith-field-group"},st={for:"stat-block-input",class:"optolith-label"},at=["placeholder"],nt={class:"optolith-helper"},rt={key:0,class:"optolith-inline-error"},it={class:"optolith-actions"},ut=["disabled"],ct=["disabled"],vt=["disabled"],dt={key:0,class:"optolith-callout optolith-callout--info",role:"status"},pt={key:1,class:"optolith-callout optolith-callout--danger",role:"alert"},ht={key:0,class:"aventuria-card aventuria-card--table optolith-result"},_t={class:"optolith-result__header"},gt={class:"aventuria-card-title optolith-result__title"},ft={class:"optolith-result__meta"},wt={class:"optolith-result__actions"},bt={key:0,class:"optolith-callout optolith-callout--warning",role:"alert"},mt={class:"optolith-callout__title"},Ct={class:"optolith-callout__list"},yt={class:"optolith-details"},kt={class:"optolith-details",open:""},S=6e3,b="optolith-converter:last",xt=B({__name:"OptolithConverterView",setup(m){const{t:e}=J(),i=_(""),u=_("idle"),v=_(null),a=_(null),h=_(null),$=`${window.location.origin}/aventuria-impromptu/`,C=g(()=>i.value.length>S),y=g(()=>u.value==="loading"||i.value.trim().length===0||C.value),k=g(()=>!!localStorage.getItem(b)),L=g(()=>a.value?JSON.stringify(a.value.exported,null,2):""),w=g(()=>{if(!a.value)return[];const s=new Set,n=r=>r.startsWith("[Parser] ")?`${e("views.optolithConverter.warnings.prefixes.parser")} ${r.slice(9)}`:r.startsWith("[Resolver] ")?`${e("views.optolithConverter.warnings.prefixes.resolver")} ${r.slice(10)}`:r.startsWith("[Exporter] ")?`${e("views.optolithConverter.warnings.prefixes.exporter")} ${r.slice(10)}`:r;return(a.value.exportedWarnings??[]).forEach(r=>s.add(n(r))),(a.value.parserWarnings??[]).forEach(r=>s.add(n(`[Parser] ${r.section??"general"}: ${r.message}`))),(a.value.resolverWarnings??[]).forEach(r=>s.add(n(`[Resolver] ${r.section}: ${r.message}`))),Object.entries(a.value.unresolved??{}).forEach(([r,U])=>{U.forEach(V=>s.add(n(`[Resolver] ${r}: ${V}`)))}),Array.from(s)});function E(){if(h.value)return h.value;const s=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return s.addEventListener("message",N),h.value=s,s}function N(s){const n=s.data;if(n){if(n.type==="error"){u.value="error",v.value=n.error;return}u.value="success",v.value=null,a.value=n.payload,R()}}function O(){if(y.value)return;u.value="loading",v.value=null,a.value=null,E().postMessage({type:"convert",payload:{source:i.value,baseUrl:$}})}function x(){const s=localStorage.getItem(b);if(s)try{const n=JSON.parse(s);i.value=n.input,a.value={...n.payload,exportedWarnings:n.payload.exportedWarnings??[]},u.value="success",v.value=null}catch(n){console.error("Failed to restore cached result",n),localStorage.removeItem(b)}}function R(){if(!a.value)return;const s={input:i.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(b,JSON.stringify(s))}function j(){if(!a.value)return;const s=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),c=document.createElement("a"),r=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");c.href=n,c.download=`${r||"npc"}-optolith.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n)}async function I(){if(w.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(w.value.join(`
`))}catch(s){console.error("Failed to copy warnings",s)}}function T(){i.value="",u.value="idle",v.value=null,a.value=null}return z(()=>{k.value&&x()}),A(()=>{h.value&&(h.value.terminate(),h.value=null)}),(s,n)=>(p(),d("section",G,[t("header",K,[t("h1",Q,o(l(e)("views.optolithConverter.title")),1),t("p",X,o(l(e)("views.optolithConverter.intro")),1)]),t("article",Y,[t("div",Z,[t("span",null,[W(o(l(e)("views.optolithConverter.roll20Note.prefix"))+" ",1),t("a",q,o(l(e)("views.optolithConverter.roll20Note.linkText")),1),W(" "+o(l(e)("views.optolithConverter.roll20Note.suffix")),1)]),t("span",null,o(l(e)("views.optolithConverter.languageNote")),1)]),t("section",tt,[t("h2",et,o(l(e)("views.optolithConverter.usage.title")),1),t("ol",ot,[t("li",null,o(l(e)("views.optolithConverter.usage.steps.paste")),1),t("li",null,o(l(e)("views.optolithConverter.usage.steps.convert")),1),t("li",null,o(l(e)("views.optolithConverter.usage.steps.review")),1),t("li",null,o(l(e)("views.optolithConverter.usage.steps.download")),1)])]),t("div",lt,[t("label",st,o(l(e)("views.optolithConverter.input.label")),1),D(t("textarea",{id:"stat-block-input","onUpdate:modelValue":n[0]||(n[0]=c=>i.value=c),class:F(["optolith-textarea",{"is-invalid":C.value}]),rows:"14",placeholder:l(e)("views.optolithConverter.input.placeholder")},null,10,at),[[M,i.value]]),t("div",nt,o(l(e)("views.optolithConverter.input.help",{max:S,current:i.value.length})),1),C.value?(p(),d("p",rt,o(l(e)("views.optolithConverter.input.tooLong")),1)):f("",!0)]),t("div",it,[t("button",{type:"button",class:"aventuria-button",disabled:y.value,onClick:O},o(l(e)("views.optolithConverter.buttons.convert")),9,ut),t("button",{type:"button",class:"aventuria-button aventuria-button--ghost",onClick:T,disabled:u.value==="loading"},o(l(e)("views.optolithConverter.buttons.reset")),9,ct),t("button",{type:"button",class:"aventuria-button aventuria-button--ghost",onClick:x,disabled:!k.value||u.value==="loading"},o(l(e)("views.optolithConverter.buttons.loadLast")),9,vt)]),u.value==="loading"?(p(),d("div",dt,o(l(e)("views.optolithConverter.loading")),1)):f("",!0),v.value?(p(),d("div",pt,o(v.value),1)):f("",!0)]),a.value?(p(),d("article",ht,[t("header",_t,[t("div",null,[t("h2",gt,o(a.value.exported.name),1),t("p",ft,o(l(e)("views.optolithConverter.datasetInfo",{schema:a.value.manifest.schemaVersion,checksum:a.value.manifest.sourceChecksum.slice(0,12)})),1)]),t("div",wt,[t("button",{type:"button",class:"aventuria-button",onClick:j},o(l(e)("views.optolithConverter.buttons.download")),1),t("button",{type:"button",class:"aventuria-button aventuria-button--ghost",onClick:I},o(l(e)("views.optolithConverter.buttons.copyWarnings")),1)])]),w.value.length>0?(p(),d("div",bt,[t("h3",mt,o(l(e)("views.optolithConverter.warnings.title")),1),t("ul",Ct,[(p(!0),d(H,null,P(w.value,c=>(p(),d("li",{key:c},o(c),1))),128))])])):f("",!0),t("details",yt,[t("summary",null,o(l(e)("views.optolithConverter.normalizedHeading")),1),t("pre",null,o(a.value.normalizedSource),1)]),t("details",kt,[t("summary",null,o(l(e)("views.optolithConverter.jsonHeading")),1),t("pre",null,o(L.value),1)])])):f("",!0)]))}}),Wt=(m,e)=>{const i=m.__vccOpts||m;for(const[u,v]of e)i[u]=v;return i},$t=Wt(xt,[["__scopeId","data-v-e635c5ea"]]);export{$t as default};
