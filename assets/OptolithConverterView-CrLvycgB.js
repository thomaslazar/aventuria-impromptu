import{d as K,u as k,r as b,c as v,o as H,a as x,b as u,e,f as p,t as l,g as a,w as S,v as L,n as Q,F as T,h as j,i as I}from"./index-DczeeBkC.js";const U={class:"container py-4"},E={class:"mb-3"},O={class:"text-muted mb-3"},D={class:"alert alert-info mb-4",role:"note"},$={class:"card shadow-sm mb-4"},M={class:"card-body"},P={class:"h5"},q={class:"mb-0 ps-3"},ee={class:"mb-3"},te={for:"stat-block-input",class:"form-label"},le=["placeholder"],oe={class:"form-text"},se={key:0,class:"invalid-feedback"},ae={class:"d-flex flex-wrap gap-2 mb-4"},ne=["disabled"],ce=["disabled"],ie=["disabled"],re={key:0,class:"alert alert-info",role:"status"},de={key:1,class:"alert alert-danger",role:"alert"},ge={key:2,class:"mb-4"},ue={class:"card shadow-sm"},Ie={class:"card-body"},Ce={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},be={class:"h5 mb-1"},ve={class:"mb-0 text-muted"},pe={class:"btn-group"},me={key:0,class:"alert alert-warning",role:"alert"},he={class:"h6 mb-2"},Ze={class:"mb-0 ps-3"},We={class:"mb-3"},Ae={class:"fw-semibold"},Ge={class:"bg-light border rounded p-3 small overflow-auto"},we={open:""},Ne={class:"fw-semibold"},Ve={class:"bg-light border rounded p-3 small overflow-auto"},N=6e3,h="optolith-converter:last",Ye=K({__name:"OptolithConverterView",setup(Z){const{t}=k(),r=b(""),d=b("idle"),g=b(null),n=b(null),C=b(null),V=`${window.location.origin}/aventuria-impromptu/`,W=v(()=>r.value.length>N),A=v(()=>d.value==="loading"||r.value.trim().length===0||W.value),G=v(()=>!!localStorage.getItem(h)),Y=v(()=>n.value?JSON.stringify(n.value.exported,null,2):""),m=v(()=>{if(!n.value)return[];const s=new Set,o=c=>c.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${c.slice(9)}`:c.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${c.slice(10)}`:c.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${c.slice(10)}`:c;return(n.value.exportedWarnings??[]).forEach(c=>s.add(o(c))),(n.value.parserWarnings??[]).forEach(c=>s.add(o(`[Parser] ${c.section??"general"}: ${c.message}`))),(n.value.resolverWarnings??[]).forEach(c=>s.add(o(`[Resolver] ${c.section}: ${c.message}`))),Object.entries(n.value.unresolved??{}).forEach(([c,J])=>{J.forEach(f=>s.add(o(`[Resolver] ${c}: ${f}`)))}),Array.from(s)});function X(){if(C.value)return C.value;const s=new URL("data:video/mp2t;base64,aW1wb3J0IHR5cGUgeyBPcHRvbGl0aERhdGFzZXQgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9kYXRhc2V0IjsKaW1wb3J0IHsgY3JlYXRlRGF0YXNldExvb2t1cHMgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9kYXRhc2V0IjsKaW1wb3J0IHsgZXhwb3J0VG9PcHRvbGl0aENoYXJhY3RlciB9IGZyb20gIi4uL3NlcnZpY2VzL29wdG9saXRoL2V4cG9ydGVyIjsKaW1wb3J0IHsgcmVzb2x2ZVN0YXRCbG9jayB9IGZyb20gIi4uL3NlcnZpY2VzL29wdG9saXRoL3Jlc29sdmVyIjsKaW1wb3J0IHsgcGFyc2VTdGF0QmxvY2sgfSBmcm9tICIuLi9zZXJ2aWNlcy9vcHRvbGl0aC9zdGF0QmxvY2tQYXJzZXIiOwppbXBvcnQgdHlwZSB7CiAgQ29udmVyc2lvbkVycm9yTWVzc2FnZSwKICBDb252ZXJzaW9uUmVxdWVzdE1lc3NhZ2UsCiAgQ29udmVyc2lvblN1Y2Nlc3NNZXNzYWdlLAp9IGZyb20gIi4uL3R5cGVzL29wdG9saXRoL2NvbnZlcnRlciI7CgpsZXQgY2FjaGVkRGF0YXNldDogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlRGF0YXNldExvb2t1cHM+IHwgdW5kZWZpbmVkOwpsZXQgY2FjaGVkTWFuaWZlc3RQYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQ7CgpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoCiAgIm1lc3NhZ2UiLAogIGFzeW5jIChldmVudDogTWVzc2FnZUV2ZW50PENvbnZlcnNpb25SZXF1ZXN0TWVzc2FnZT4pID0+IHsKICAgIGNvbnN0IG1lc3NhZ2UgPSBldmVudC5kYXRhOwogICAgaWYgKCFtZXNzYWdlIHx8IG1lc3NhZ2UudHlwZSAhPT0gImNvbnZlcnQiKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICBjb25zdCBkYXRhc2V0ID0gYXdhaXQgbG9hZERhdGFzZXQobWVzc2FnZS5wYXlsb2FkLmJhc2VVcmwpOwogICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZVN0YXRCbG9jayhtZXNzYWdlLnBheWxvYWQuc291cmNlKTsKICAgICAgY29uc3QgcmVzb2x2ZWQgPSByZXNvbHZlU3RhdEJsb2NrKHBhcnNlZC5tb2RlbCwgZGF0YXNldCk7CiAgICAgIGNvbnN0IHsgaGVybywgd2FybmluZ3M6IGV4cG9ydGVkV2FybmluZ3MgfSA9IGV4cG9ydFRvT3B0b2xpdGhDaGFyYWN0ZXIoewogICAgICAgIGRhdGFzZXQsCiAgICAgICAgcGFyc2VkLAogICAgICAgIHJlc29sdmVkLAogICAgICB9KTsKCiAgICAgIGNvbnN0IHJlc3BvbnNlOiBDb252ZXJzaW9uU3VjY2Vzc01lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogInJlc3VsdCIsCiAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgZXhwb3J0ZWQ6IGhlcm8sCiAgICAgICAgICBleHBvcnRlZFdhcm5pbmdzLAogICAgICAgICAgbWFuaWZlc3Q6IGRhdGFzZXQubWFuaWZlc3QsCiAgICAgICAgICBub3JtYWxpemVkU291cmNlOiBwYXJzZWQubm9ybWFsaXplZFNvdXJjZSwKICAgICAgICAgIHBhcnNlcldhcm5pbmdzOiBwYXJzZWQud2FybmluZ3MsCiAgICAgICAgICByZXNvbHZlcldhcm5pbmdzOiByZXNvbHZlZC53YXJuaW5ncywKICAgICAgICAgIHVucmVzb2x2ZWQ6IHJlc29sdmVkLnVucmVzb2x2ZWQsCiAgICAgICAgfSwKICAgICAgfTsKCiAgICAgIHBvc3RNZXNzYWdlKHJlc3BvbnNlKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlOiBDb252ZXJzaW9uRXJyb3JNZXNzYWdlID0gewogICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSwKICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UocmVzcG9uc2UpOwogICAgfQogIH0sCik7Cgphc3luYyBmdW5jdGlvbiBsb2FkRGF0YXNldChiYXNlVXJsOiBzdHJpbmcpIHsKICBjb25zdCBtYW5pZmVzdFVybCA9IG5ldyBVUkwoCiAgICAiZGF0YS9vcHRvbGl0aC9tYW5pZmVzdC5qc29uIiwKICAgIGJhc2VVcmwsCiAgKS50b1N0cmluZygpOwogIGlmIChjYWNoZWREYXRhc2V0ICYmIGNhY2hlZE1hbmlmZXN0UGF0aCA9PT0gbWFuaWZlc3RVcmwpIHsKICAgIHJldHVybiBjYWNoZWREYXRhc2V0OwogIH0KCiAgY29uc3QgbWFuaWZlc3RSZXNwb25zZSA9IGF3YWl0IGZldGNoKG1hbmlmZXN0VXJsKTsKICBpZiAoIW1hbmlmZXN0UmVzcG9uc2Uub2spIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgYE1hbmlmZXN0IGtvbm50ZSBuaWNodCBnZWxhZGVuIHdlcmRlbiAoJHttYW5pZmVzdFJlc3BvbnNlLnN0YXR1c30pYCwKICAgICk7CiAgfQogIGNvbnN0IG1hbmlmZXN0ID0KICAgIChhd2FpdCBtYW5pZmVzdFJlc3BvbnNlLmpzb24oKSkgYXMgT3B0b2xpdGhEYXRhc2V0WyJtYW5pZmVzdCJdOwoKICBjb25zdCByZWFkU2VjdGlvbiA9IGFzeW5jIChmaWxlOiBzdHJpbmcpID0+IHsKICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYGRhdGEvb3B0b2xpdGgvJHtmaWxlfWAsIGJhc2VVcmwpLnRvU3RyaW5nKCk7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICBgRGF0ZW5zYXR6ICR7ZmlsZX0ga29ubnRlIG5pY2h0IGdlbGFkZW4gd2VyZGVuICgke3Jlc3BvbnNlLnN0YXR1c30pYCwKICAgICAgKTsKICAgIH0KICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgfTsKCiAgY29uc3QgZGF0YXNldDogT3B0b2xpdGhEYXRhc2V0ID0gewogICAgbWFuaWZlc3QsCiAgICBhZHZhbnRhZ2VzOiBhd2FpdCByZWFkU2VjdGlvbihmaW5kU2VjdGlvbkZpbGUobWFuaWZlc3QsICJhZHZhbnRhZ2VzIikpLAogICAgZGlzYWR2YW50YWdlczogYXdhaXQgcmVhZFNlY3Rpb24oCiAgICAgIGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImRpc2FkdmFudGFnZXMiKSwKICAgICksCiAgICBzcGVjaWFsQWJpbGl0aWVzOiBhd2FpdCByZWFkU2VjdGlvbigKICAgICAgZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAic3BlY2lhbEFiaWxpdGllcyIpLAogICAgKSwKICAgIHNraWxsczogYXdhaXQgcmVhZFNlY3Rpb24oZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAic2tpbGxzIikpLAogICAgY29tYmF0VGVjaG5pcXVlczogYXdhaXQgcmVhZFNlY3Rpb24oCiAgICAgIGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImNvbWJhdFRlY2huaXF1ZXMiKSwKICAgICksCiAgICBzcGVsbHM6IGF3YWl0IHJlYWRTZWN0aW9uKGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgInNwZWxscyIpKSwKICAgIGxpdHVyZ2llczogYXdhaXQgcmVhZFNlY3Rpb24oZmluZFNlY3Rpb25GaWxlKG1hbmlmZXN0LCAibGl0dXJnaWVzIikpLAogICAgYmxlc3NpbmdzOiBhd2FpdCByZWFkU2VjdGlvbihmaW5kU2VjdGlvbkZpbGUobWFuaWZlc3QsICJibGVzc2luZ3MiKSksCiAgICBlcXVpcG1lbnQ6IGF3YWl0IHJlYWRTZWN0aW9uKGZpbmRTZWN0aW9uRmlsZShtYW5pZmVzdCwgImVxdWlwbWVudCIpKSwKICB9OwoKICBjYWNoZWREYXRhc2V0ID0gY3JlYXRlRGF0YXNldExvb2t1cHMoZGF0YXNldCk7CiAgY2FjaGVkTWFuaWZlc3RQYXRoID0gbWFuaWZlc3RVcmw7CiAgcmV0dXJuIGNhY2hlZERhdGFzZXQ7Cn0KCmZ1bmN0aW9uIGZpbmRTZWN0aW9uRmlsZSgKICBtYW5pZmVzdDogT3B0b2xpdGhEYXRhc2V0WyJtYW5pZmVzdCJdLAogIGtleTogc3RyaW5nLAopOiBzdHJpbmcgewogIGNvbnN0IHNlY3Rpb24gPSBtYW5pZmVzdC5zZWN0aW9ucy5maW5kKChjYW5kaWRhdGUpID0+IGNhbmRpZGF0ZS5rZXkgPT09IGtleSk7CiAgaWYgKCFzZWN0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYE1hbmlmZXN0YWJzY2huaXR0IGZlaGx0OiAke2tleX1gKTsKICB9CiAgcmV0dXJuIHNlY3Rpb24uZmlsZTsKfQo=",import.meta.url);{const i="/aventuria-impromptu/".replace(/\/$/,"");s.pathname=`${i}${s.pathname}`}const o=new Worker(s,{type:"module"});return o.addEventListener("message",y),C.value=o,o}function y(s){const o=s.data;if(o){if(o.type==="error"){d.value="error",g.value=o.error;return}d.value="success",g.value=null,n.value=o.payload,B()}}function R(){if(A.value)return;d.value="loading",g.value=null,n.value=null,X().postMessage({type:"convert",payload:{source:r.value,baseUrl:V}})}function w(){const s=localStorage.getItem(h);if(s)try{const o=JSON.parse(s);r.value=o.input,n.value={...o.payload,exportedWarnings:o.payload.exportedWarnings??[]},d.value="success",g.value=null}catch(o){console.error("Failed to restore cached result",o),localStorage.removeItem(h)}}function B(){if(!n.value)return;const s={input:r.value,payload:n.value,storedAt:new Date().toISOString()};localStorage.setItem(h,JSON.stringify(s))}function z(){if(!n.value)return;const s=new Blob([JSON.stringify(n.value.exported,null,2)],{type:"application/json"}),o=URL.createObjectURL(s),i=document.createElement("a"),c=n.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");i.href=o,i.download=`${c||"npc"}-optolith.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}async function F(){if(m.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(m.value.join(`
`))}catch(s){console.error("Failed to copy warnings",s)}}function _(){r.value="",d.value="idle",g.value=null,n.value=null}return H(()=>{G.value&&w()}),x(()=>{C.value&&(C.value.terminate(),C.value=null)}),(s,o)=>(I(),u("div",U,[e("h1",E,l(a(t)("views.optolithConverter.title")),1),e("p",O,l(a(t)("views.optolithConverter.intro")),1),e("div",D,l(a(t)("views.optolithConverter.languageNote")),1),e("div",$,[e("div",M,[e("h2",P,l(a(t)("views.optolithConverter.usage.title")),1),e("ol",q,[e("li",null,l(a(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,l(a(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,l(a(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,l(a(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",ee,[e("label",te,l(a(t)("views.optolithConverter.input.label")),1),S(e("textarea",{id:"stat-block-input","onUpdate:modelValue":o[0]||(o[0]=i=>r.value=i),class:Q(["form-control",{"is-invalid":W.value}]),rows:"14",placeholder:a(t)("views.optolithConverter.input.placeholder")},null,10,le),[[L,r.value]]),e("div",oe,l(a(t)("views.optolithConverter.input.help",{max:N,current:r.value.length})),1),W.value?(I(),u("div",se,l(a(t)("views.optolithConverter.input.tooLong")),1)):p("",!0)]),e("div",ae,[e("button",{type:"button",class:"btn btn-primary",disabled:A.value,onClick:R},l(a(t)("views.optolithConverter.buttons.convert")),9,ne),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:_,disabled:d.value==="loading"},l(a(t)("views.optolithConverter.buttons.reset")),9,ce),e("button",{type:"button",class:"btn btn-outline-success",onClick:w,disabled:!G.value||d.value==="loading"},l(a(t)("views.optolithConverter.buttons.loadLast")),9,ie)]),d.value==="loading"?(I(),u("div",re,l(a(t)("views.optolithConverter.loading")),1)):p("",!0),g.value?(I(),u("div",de,l(g.value),1)):p("",!0),n.value?(I(),u("section",ge,[e("div",ue,[e("div",Ie,[e("div",Ce,[e("div",null,[e("h2",be,l(n.value.exported.name),1),e("p",ve,l(a(t)("views.optolithConverter.datasetInfo",{schema:n.value.manifest.schemaVersion,checksum:n.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",pe,[e("button",{type:"button",class:"btn btn-success",onClick:z},l(a(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:F},l(a(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),m.value.length>0?(I(),u("div",me,[e("h3",he,l(a(t)("views.optolithConverter.warnings.title")),1),e("ul",Ze,[(I(!0),u(T,null,j(m.value,i=>(I(),u("li",{key:i},l(i),1))),128))])])):p("",!0),e("details",We,[e("summary",Ae,l(a(t)("views.optolithConverter.normalizedHeading")),1),e("pre",Ge,l(n.value.normalizedSource),1)]),e("details",we,[e("summary",Ne,l(a(t)("views.optolithConverter.jsonHeading")),1),e("pre",Ve,l(Y.value),1)])])])])):p("",!0)]))}}),Xe=(Z,t)=>{const r=Z.__vccOpts||Z;for(const[d,g]of t)r[d]=g;return r},Re=Xe(Ye,[["__scopeId","data-v-2f4a356f"]]);export{Re as default};
