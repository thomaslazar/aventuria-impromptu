import{d as J,u as T,r as _,c as b,o as V,a as z,b as v,e,f as m,t as o,g as s,w as A,v as D,n as M,F,h as H,i as p}from"./index-Xg-U81d6.js";const P={class:"container py-4"},G={class:"mb-3"},K={class:"text-muted mb-3"},Q={class:"mb-3"},X={class:"alert alert-info mb-4",role:"note"},Y={class:"card shadow-sm mb-4"},Z={class:"card-body"},q={class:"h5"},ee={class:"mb-0 ps-3"},te={class:"mb-3"},oe={for:"stat-block-input",class:"form-label"},se=["placeholder"],ne={class:"form-text"},re={key:0,class:"invalid-feedback"},ae={class:"d-flex flex-wrap gap-2 mb-4"},le=["disabled"],ie=["disabled"],ce=["disabled"],ue={key:0,class:"alert alert-info",role:"status"},de={key:1,class:"alert alert-danger",role:"alert"},ve={key:2,class:"mb-4"},pe={class:"card shadow-sm"},he={class:"card-body"},_e={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},be={class:"h5 mb-1"},me={class:"mb-0 text-muted"},fe={class:"btn-group"},ge={key:0,class:"alert alert-warning",role:"alert"},we={class:"h6 mb-2"},ye={class:"mb-0 ps-3"},Ce={class:"mb-3"},xe={class:"fw-semibold"},ke={class:"bg-light border rounded p-3 small overflow-auto"},We={open:""},Se={class:"fw-semibold"},$e={class:"bg-light border rounded p-3 small overflow-auto"},W=6e3,g="optolith-converter:last",Le=J({__name:"OptolithConverterView",setup(w){const{t}=T(),i=_(""),c=_("idle"),d=_(null),r=_(null),h=_(null),S=`${window.location.origin}/aventuria-impromptu/`,y=b(()=>i.value.length>W),C=b(()=>c.value==="loading"||i.value.trim().length===0||y.value),x=b(()=>!!localStorage.getItem(g)),$=b(()=>r.value?JSON.stringify(r.value.exported,null,2):""),f=b(()=>{if(!r.value)return[];const n=new Set,a=l=>l.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${l.slice(9)}`:l.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${l.slice(10)}`:l.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${l.slice(10)}`:l;return(r.value.exportedWarnings??[]).forEach(l=>n.add(a(l))),(r.value.parserWarnings??[]).forEach(l=>n.add(a(`[Parser] ${l.section??"general"}: ${l.message}`))),(r.value.resolverWarnings??[]).forEach(l=>n.add(a(`[Resolver] ${l.section}: ${l.message}`))),Object.entries(r.value.unresolved??{}).forEach(([l,U])=>{U.forEach(B=>n.add(a(`[Resolver] ${l}: ${B}`)))}),Array.from(n)});function L(){if(h.value)return h.value;const n=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return n.addEventListener("message",E),h.value=n,n}function E(n){const a=n.data;if(a){if(a.type==="error"){c.value="error",d.value=a.error;return}c.value="success",d.value=null,r.value=a.payload,R()}}function O(){if(C.value)return;c.value="loading",d.value=null,r.value=null,L().postMessage({type:"convert",payload:{source:i.value,baseUrl:S}})}function k(){const n=localStorage.getItem(g);if(n)try{const a=JSON.parse(n);i.value=a.input,r.value={...a.payload,exportedWarnings:a.payload.exportedWarnings??[]},c.value="success",d.value=null}catch(a){console.error("Failed to restore cached result",a),localStorage.removeItem(g)}}function R(){if(!r.value)return;const n={input:i.value,payload:r.value,storedAt:new Date().toISOString()};localStorage.setItem(g,JSON.stringify(n))}function N(){if(!r.value)return;const n=new Blob([JSON.stringify(r.value.exported,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),u=document.createElement("a"),l=r.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");u.href=a,u.download=`${l||"npc"}-optolith.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a)}async function j(){if(f.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(f.value.join(`
`))}catch(n){console.error("Failed to copy warnings",n)}}function I(){i.value="",c.value="idle",d.value=null,r.value=null}return V(()=>{x.value&&k()}),z(()=>{h.value&&(h.value.terminate(),h.value=null)}),(n,a)=>(p(),v("div",P,[e("h1",G,o(s(t)("views.optolithConverter.title")),1),e("p",K,o(s(t)("views.optolithConverter.intro")),1),e("p",Q,o(s(t)("views.optolithConverter.roll20Note")),1),e("div",X,o(s(t)("views.optolithConverter.languageNote")),1),e("div",Y,[e("div",Z,[e("h2",q,o(s(t)("views.optolithConverter.usage.title")),1),e("ol",ee,[e("li",null,o(s(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,o(s(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",te,[e("label",oe,o(s(t)("views.optolithConverter.input.label")),1),A(e("textarea",{id:"stat-block-input","onUpdate:modelValue":a[0]||(a[0]=u=>i.value=u),class:M(["form-control",{"is-invalid":y.value}]),rows:"14",placeholder:s(t)("views.optolithConverter.input.placeholder")},null,10,se),[[D,i.value]]),e("div",ne,o(s(t)("views.optolithConverter.input.help",{max:W,current:i.value.length})),1),y.value?(p(),v("div",re,o(s(t)("views.optolithConverter.input.tooLong")),1)):m("",!0)]),e("div",ae,[e("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:O},o(s(t)("views.optolithConverter.buttons.convert")),9,le),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:I,disabled:c.value==="loading"},o(s(t)("views.optolithConverter.buttons.reset")),9,ie),e("button",{type:"button",class:"btn btn-outline-success",onClick:k,disabled:!x.value||c.value==="loading"},o(s(t)("views.optolithConverter.buttons.loadLast")),9,ce)]),c.value==="loading"?(p(),v("div",ue,o(s(t)("views.optolithConverter.loading")),1)):m("",!0),d.value?(p(),v("div",de,o(d.value),1)):m("",!0),r.value?(p(),v("section",ve,[e("div",pe,[e("div",he,[e("div",_e,[e("div",null,[e("h2",be,o(r.value.exported.name),1),e("p",me,o(s(t)("views.optolithConverter.datasetInfo",{schema:r.value.manifest.schemaVersion,checksum:r.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",fe,[e("button",{type:"button",class:"btn btn-success",onClick:N},o(s(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:j},o(s(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),f.value.length>0?(p(),v("div",ge,[e("h3",we,o(s(t)("views.optolithConverter.warnings.title")),1),e("ul",ye,[(p(!0),v(F,null,H(f.value,u=>(p(),v("li",{key:u},o(u),1))),128))])])):m("",!0),e("details",Ce,[e("summary",xe,o(s(t)("views.optolithConverter.normalizedHeading")),1),e("pre",ke,o(r.value.normalizedSource),1)]),e("details",We,[e("summary",Se,o(s(t)("views.optolithConverter.jsonHeading")),1),e("pre",$e,o($.value),1)])])])])):m("",!0)]))}}),Ee=(w,t)=>{const i=w.__vccOpts||w;for(const[c,d]of t)i[c]=d;return i},Re=Ee(Le,[["__scopeId","data-v-7eb7a85e"]]);export{Re as default};
