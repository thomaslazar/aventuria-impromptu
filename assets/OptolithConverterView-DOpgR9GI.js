import{d as B,u as J,r as _,c as b,o as T,a as z,b as v,e,f as A,g as m,t as o,h as l,w as D,i as M,j as F,v as H,n as P,F as G,k as K,l as p}from"./index-vjuWD-jp.js";const Q={class:"container py-4"},X={class:"mb-3"},Y={class:"text-muted mb-3"},Z={class:"alert alert-info mb-4",role:"note"},q={class:"card shadow-sm mb-4"},ee={class:"card-body"},te={class:"h5"},oe={class:"mb-0 ps-3"},se={class:"mb-3"},ne={for:"stat-block-input",class:"form-label"},re=["placeholder"],le={class:"form-text"},ae={key:0,class:"invalid-feedback"},ie={class:"d-flex flex-wrap gap-2 mb-4"},ce=["disabled"],ue=["disabled"],de=["disabled"],ve={key:0,class:"alert alert-info",role:"status"},pe={key:1,class:"alert alert-danger",role:"alert"},he={key:2,class:"mb-4"},_e={class:"card shadow-sm"},be={class:"card-body"},me={class:"d-flex flex-wrap justify-content-between gap-2 align-items-center mb-3"},fe={class:"h5 mb-1"},ge={class:"mb-0 text-muted"},we={class:"btn-group"},ye={key:0,class:"alert alert-warning",role:"alert"},Ce={class:"h6 mb-2"},ke={class:"mb-0 ps-3"},xe={class:"mb-3"},We={class:"fw-semibold"},Se={class:"bg-light border rounded p-3 small overflow-auto"},$e={open:""},Le={class:"fw-semibold"},Ee={class:"bg-light border rounded p-3 small overflow-auto"},W=6e3,g="optolith-converter:last",Re=B({__name:"OptolithConverterView",setup(w){const{t}=J(),i=_(""),c=_("idle"),u=_(null),a=_(null),h=_(null),S=`${window.location.origin}/aventuria-impromptu/`,y=b(()=>i.value.length>W),C=b(()=>c.value==="loading"||i.value.trim().length===0||y.value),k=b(()=>!!localStorage.getItem(g)),$=b(()=>a.value?JSON.stringify(a.value.exported,null,2):""),f=b(()=>{if(!a.value)return[];const r=new Set,n=s=>s.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${s.slice(9)}`:s.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${s.slice(10)}`:s.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${s.slice(10)}`:s;return(a.value.exportedWarnings??[]).forEach(s=>r.add(n(s))),(a.value.parserWarnings??[]).forEach(s=>r.add(n(`[Parser] ${s.section??"general"}: ${s.message}`))),(a.value.resolverWarnings??[]).forEach(s=>r.add(n(`[Resolver] ${s.section}: ${s.message}`))),Object.entries(a.value.unresolved??{}).forEach(([s,U])=>{U.forEach(V=>r.add(n(`[Resolver] ${s}: ${V}`)))}),Array.from(r)});function L(){if(h.value)return h.value;const r=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return r.addEventListener("message",E),h.value=r,r}function E(r){const n=r.data;if(n){if(n.type==="error"){c.value="error",u.value=n.error;return}c.value="success",u.value=null,a.value=n.payload,O()}}function R(){if(C.value)return;c.value="loading",u.value=null,a.value=null,L().postMessage({type:"convert",payload:{source:i.value,baseUrl:S}})}function x(){const r=localStorage.getItem(g);if(r)try{const n=JSON.parse(r);i.value=n.input,a.value={...n.payload,exportedWarnings:n.payload.exportedWarnings??[]},c.value="success",u.value=null}catch(n){console.error("Failed to restore cached result",n),localStorage.removeItem(g)}}function O(){if(!a.value)return;const r={input:i.value,payload:a.value,storedAt:new Date().toISOString()};localStorage.setItem(g,JSON.stringify(r))}function N(){if(!a.value)return;const r=new Blob([JSON.stringify(a.value.exported,null,2)],{type:"application/json"}),n=URL.createObjectURL(r),d=document.createElement("a"),s=a.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");d.href=n,d.download=`${s||"npc"}-optolith.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(n)}async function j(){if(f.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(f.value.join(`
`))}catch(r){console.error("Failed to copy warnings",r)}}function I(){i.value="",c.value="idle",u.value=null,a.value=null}return T(()=>{k.value&&x()}),z(()=>{h.value&&(h.value.terminate(),h.value=null)}),(r,n)=>{const d=M("i18n-t");return p(),v("div",Q,[e("h1",X,o(l(t)("views.optolithConverter.title")),1),e("p",Y,o(l(t)("views.optolithConverter.intro")),1),A(d,{tag:"p",class:"mb-3",keypath:"views.optolithConverter.roll20Note"},{link:D(()=>[...n[1]||(n[1]=[e("a",{href:"https://roll20.net",target:"_blank",rel:"noopener noreferrer"}," Roll20.net ",-1)])]),_:1}),e("div",Z,o(l(t)("views.optolithConverter.languageNote")),1),e("div",q,[e("div",ee,[e("h2",te,o(l(t)("views.optolithConverter.usage.title")),1),e("ol",oe,[e("li",null,o(l(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.download")),1)])])]),e("div",se,[e("label",ne,o(l(t)("views.optolithConverter.input.label")),1),F(e("textarea",{id:"stat-block-input","onUpdate:modelValue":n[0]||(n[0]=s=>i.value=s),class:P(["form-control",{"is-invalid":y.value}]),rows:"14",placeholder:l(t)("views.optolithConverter.input.placeholder")},null,10,re),[[H,i.value]]),e("div",le,o(l(t)("views.optolithConverter.input.help",{max:W,current:i.value.length})),1),y.value?(p(),v("div",ae,o(l(t)("views.optolithConverter.input.tooLong")),1)):m("",!0)]),e("div",ie,[e("button",{type:"button",class:"btn btn-primary",disabled:C.value,onClick:R},o(l(t)("views.optolithConverter.buttons.convert")),9,ce),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:I,disabled:c.value==="loading"},o(l(t)("views.optolithConverter.buttons.reset")),9,ue),e("button",{type:"button",class:"btn btn-outline-success",onClick:x,disabled:!k.value||c.value==="loading"},o(l(t)("views.optolithConverter.buttons.loadLast")),9,de)]),c.value==="loading"?(p(),v("div",ve,o(l(t)("views.optolithConverter.loading")),1)):m("",!0),u.value?(p(),v("div",pe,o(u.value),1)):m("",!0),a.value?(p(),v("section",he,[e("div",_e,[e("div",be,[e("div",me,[e("div",null,[e("h2",fe,o(a.value.exported.name),1),e("p",ge,o(l(t)("views.optolithConverter.datasetInfo",{schema:a.value.manifest.schemaVersion,checksum:a.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",we,[e("button",{type:"button",class:"btn btn-success",onClick:N},o(l(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:j},o(l(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),f.value.length>0?(p(),v("div",ye,[e("h3",Ce,o(l(t)("views.optolithConverter.warnings.title")),1),e("ul",ke,[(p(!0),v(G,null,K(f.value,s=>(p(),v("li",{key:s},o(s),1))),128))])])):m("",!0),e("details",xe,[e("summary",We,o(l(t)("views.optolithConverter.normalizedHeading")),1),e("pre",Se,o(a.value.normalizedSource),1)]),e("details",$e,[e("summary",Le,o(l(t)("views.optolithConverter.jsonHeading")),1),e("pre",Ee,o($.value),1)])])])])):m("",!0)])}}}),Oe=(w,t)=>{const i=w.__vccOpts||w;for(const[c,u]of t)i[c]=u;return i},je=Oe(Re,[["__scopeId","data-v-8126d55b"]]);export{je as default};
