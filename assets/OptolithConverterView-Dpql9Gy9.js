import{d as B,u as J,r as _,c as g,o as z,a as A,b as p,e,f,t as o,g as l,h as W,w as D,v as M,n as F,F as H,i as P,j as v}from"./index-BNndZzDo.js";const G={class:"codex-section optolith-view"},K={class:"codex-section-header"},Q={class:"codex-section-title"},X={class:"codex-section-intro optolith-intro"},Y={class:"codex-card codex-card--table optolith-card"},Z={class:"optolith-callout optolith-callout--accent",role:"note"},q={class:"optolith-roll20__link",href:"https://roll20.net",target:"_blank",rel:"noopener noreferrer"},ee={class:"optolith-usage"},te={class:"codex-card-title optolith-usage__title"},oe={class:"optolith-usage__list"},le={class:"optolith-field-group"},se={for:"stat-block-input",class:"optolith-label"},ne=["placeholder"],re={class:"optolith-helper"},ae={key:0,class:"optolith-inline-error"},ie={class:"optolith-actions"},ce=["disabled"],ue=["disabled"],de=["disabled"],pe={key:0,class:"optolith-callout optolith-callout--info",role:"status"},ve={key:1,class:"optolith-callout optolith-callout--danger",role:"alert"},he={key:0,class:"codex-card codex-card--table optolith-result"},_e={class:"optolith-result__header"},ge={class:"codex-card-title optolith-result__title"},fe={class:"optolith-result__meta"},we={class:"optolith-result__actions"},be={key:0,class:"optolith-callout optolith-callout--warning",role:"alert"},me={class:"optolith-callout__title"},xe={class:"optolith-callout__list"},Ce={class:"optolith-details"},ye={class:"optolith-details",open:""},S=6e3,b="optolith-converter:last",ke=B({__name:"OptolithConverterView",setup(m){const{t}=J(),i=_(""),c=_("idle"),d=_(null),n=_(null),h=_(null),$=`${window.location.origin}/aventuria-impromptu/`,x=g(()=>i.value.length>S),C=g(()=>c.value==="loading"||i.value.trim().length===0||x.value),y=g(()=>!!localStorage.getItem(b)),L=g(()=>n.value?JSON.stringify(n.value.exported,null,2):""),w=g(()=>{if(!n.value)return[];const s=new Set,r=a=>a.startsWith("[Parser] ")?`${t("views.optolithConverter.warnings.prefixes.parser")} ${a.slice(9)}`:a.startsWith("[Resolver] ")?`${t("views.optolithConverter.warnings.prefixes.resolver")} ${a.slice(10)}`:a.startsWith("[Exporter] ")?`${t("views.optolithConverter.warnings.prefixes.exporter")} ${a.slice(10)}`:a;return(n.value.exportedWarnings??[]).forEach(a=>s.add(r(a))),(n.value.parserWarnings??[]).forEach(a=>s.add(r(`[Parser] ${a.section??"general"}: ${a.message}`))),(n.value.resolverWarnings??[]).forEach(a=>s.add(r(`[Resolver] ${a.section}: ${a.message}`))),Object.entries(n.value.unresolved??{}).forEach(([a,U])=>{U.forEach(V=>s.add(r(`[Resolver] ${a}: ${V}`)))}),Array.from(s)});function E(){if(h.value)return h.value;const s=new Worker(new URL("/aventuria-impromptu/assets/optolithConverter.worker-DkDQZop-.js",import.meta.url),{type:"module"});return s.addEventListener("message",N),h.value=s,s}function N(s){const r=s.data;if(r){if(r.type==="error"){c.value="error",d.value=r.error;return}c.value="success",d.value=null,n.value=r.payload,R()}}function O(){if(C.value)return;c.value="loading",d.value=null,n.value=null,E().postMessage({type:"convert",payload:{source:i.value,baseUrl:$}})}function k(){const s=localStorage.getItem(b);if(s)try{const r=JSON.parse(s);i.value=r.input,n.value={...r.payload,exportedWarnings:r.payload.exportedWarnings??[]},c.value="success",d.value=null}catch(r){console.error("Failed to restore cached result",r),localStorage.removeItem(b)}}function R(){if(!n.value)return;const s={input:i.value,payload:n.value,storedAt:new Date().toISOString()};localStorage.setItem(b,JSON.stringify(s))}function j(){if(!n.value)return;const s=new Blob([JSON.stringify(n.value.exported,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),u=document.createElement("a"),a=n.value.exported.name.toLowerCase().replace(/[^a-z0-9-]+/g,"-");u.href=r,u.download=`${a||"npc"}-optolith.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(r)}async function I(){if(w.value.length!==0)try{if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not available");await navigator.clipboard.writeText(w.value.join(`
`))}catch(s){console.error("Failed to copy warnings",s)}}function T(){i.value="",c.value="idle",d.value=null,n.value=null}return z(()=>{y.value&&k()}),A(()=>{h.value&&(h.value.terminate(),h.value=null)}),(s,r)=>(v(),p("section",G,[e("header",K,[e("h1",Q,o(l(t)("views.optolithConverter.title")),1),e("p",X,o(l(t)("views.optolithConverter.intro")),1)]),e("article",Y,[e("div",Z,[e("span",null,[W(o(l(t)("views.optolithConverter.roll20Note.prefix"))+" ",1),e("a",q,o(l(t)("views.optolithConverter.roll20Note.linkText")),1),W(" "+o(l(t)("views.optolithConverter.roll20Note.suffix")),1)]),e("span",null,o(l(t)("views.optolithConverter.languageNote")),1)]),e("section",ee,[e("h2",te,o(l(t)("views.optolithConverter.usage.title")),1),e("ol",oe,[e("li",null,o(l(t)("views.optolithConverter.usage.steps.paste")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.convert")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.review")),1),e("li",null,o(l(t)("views.optolithConverter.usage.steps.download")),1)])]),e("div",le,[e("label",se,o(l(t)("views.optolithConverter.input.label")),1),D(e("textarea",{id:"stat-block-input","onUpdate:modelValue":r[0]||(r[0]=u=>i.value=u),class:F(["optolith-textarea",{"is-invalid":x.value}]),rows:"14",placeholder:l(t)("views.optolithConverter.input.placeholder")},null,10,ne),[[M,i.value]]),e("div",re,o(l(t)("views.optolithConverter.input.help",{max:S,current:i.value.length})),1),x.value?(v(),p("p",ae,o(l(t)("views.optolithConverter.input.tooLong")),1)):f("",!0)]),e("div",ie,[e("button",{type:"button",class:"codex-button",disabled:C.value,onClick:O},o(l(t)("views.optolithConverter.buttons.convert")),9,ce),e("button",{type:"button",class:"codex-button codex-button--ghost",onClick:T,disabled:c.value==="loading"},o(l(t)("views.optolithConverter.buttons.reset")),9,ue),e("button",{type:"button",class:"codex-button codex-button--ghost",onClick:k,disabled:!y.value||c.value==="loading"},o(l(t)("views.optolithConverter.buttons.loadLast")),9,de)]),c.value==="loading"?(v(),p("div",pe,o(l(t)("views.optolithConverter.loading")),1)):f("",!0),d.value?(v(),p("div",ve,o(d.value),1)):f("",!0)]),n.value?(v(),p("article",he,[e("header",_e,[e("div",null,[e("h2",ge,o(n.value.exported.name),1),e("p",fe,o(l(t)("views.optolithConverter.datasetInfo",{schema:n.value.manifest.schemaVersion,checksum:n.value.manifest.sourceChecksum.slice(0,12)})),1)]),e("div",we,[e("button",{type:"button",class:"codex-button",onClick:j},o(l(t)("views.optolithConverter.buttons.download")),1),e("button",{type:"button",class:"codex-button codex-button--ghost",onClick:I},o(l(t)("views.optolithConverter.buttons.copyWarnings")),1)])]),w.value.length>0?(v(),p("div",be,[e("h3",me,o(l(t)("views.optolithConverter.warnings.title")),1),e("ul",xe,[(v(!0),p(H,null,P(w.value,u=>(v(),p("li",{key:u},o(u),1))),128))])])):f("",!0),e("details",Ce,[e("summary",null,o(l(t)("views.optolithConverter.normalizedHeading")),1),e("pre",null,o(n.value.normalizedSource),1)]),e("details",ye,[e("summary",null,o(l(t)("views.optolithConverter.jsonHeading")),1),e("pre",null,o(L.value),1)])])):f("",!0)]))}}),We=(m,t)=>{const i=m.__vccOpts||m;for(const[c,d]of t)i[c]=d;return i},$e=We(ke,[["__scopeId","data-v-66beae51"]]);export{$e as default};
