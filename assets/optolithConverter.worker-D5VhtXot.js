(function(){"use strict";function b(n){return n.toLocaleLowerCase("de-DE").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g," ").trim()}function me(n){const e=E(n.specialAbilities);return{manifest:n.manifest,advantages:E(n.advantages),disadvantages:E(n.disadvantages),specialAbilities:e,skills:E(n.skills),combatTechniques:E(n.combatTechniques),spells:E(n.spells),liturgies:E(n.liturgies),blessings:E(n.blessings),equipment:E(n.equipment),languages:x(n.specialAbilities,"SA_29"),scripts:x(n.specialAbilities,"SA_27")}}function E(n){const e=new Map,t=new Map;for(const i of n){e.set(i.id,i),t.set(i.normalizedName,i);for(const a of i.synonyms??[]){const r=b(a);r&&(t.has(r)||t.set(r,i))}const s=typeof i.locale?.name=="string"?String(i.locale.name):void 0;if(s){const a=b(s);a&&!t.has(a)&&t.set(a,i)}}return{byId:e,byName:t}}function x(n,e){const t=n.find(o=>o.id===e),i=new Map;if(!t)return i;const s=t.locale,a=Array.isArray(s?.selectOptions)?s.selectOptions:[],r=typeof t.base=="object"&&t.base!==null?Number.parseInt(String(t.base.levels??""),10):void 0;for(const o of a){if(!o||typeof o.name!="string"||typeof o.id!="number")continue;const c=b(o.name);i.set(c,{ability:t,optionId:o.id,name:o.name,normalizedName:c,maxLevel:Number.isFinite(r)?r:void 0})}return i}function X(n){return n===void 0||n<=8?0:Math.floor((n-8)/3)}function fe(n){if(!n)return{at:0,fk:0};const t=n.base?.special;return{at:typeof t?.at=="number"?t.at:0,fk:typeof t?.fk=="number"?t.fk:0}}function de(n){if(n.combatTechnique?.id)return n.combatTechnique.id;if(n.fallback==="unarmed")return"CT_9"}function pe(n,e,t){const i=n.model.attributes.MU??0,s=n.model.attributes.FF??0,a=[],r=[],o=new Map,c=(l,m,p,d)=>{const h=Math.max(6,Math.round(p)),f=o.get(l);if(f){if(f.sources.some(k=>k.name===d)||f.sources.push({name:d,value:h}),h>f.value&&(f.value=h),new Set(f.sources.map(k=>k.value)).size>1){const k=f.sources.map(w=>`${w.name} ⇒ ${w.value}`).join(", ");r.push(`[Exporter] combatTechniques: Technik ${m??l} hat widersprüchliche Werte (${k}).`)}}else o.set(l,{value:h,sources:[{name:d,value:h}]})},u=l=>t.combatTechniques.byId.get(l)?.name;for(const l of e.weapons){const m=de(l);if(!m)continue;const p=fe(l.match),d=u(m);let h,f=0,g=0;const k=l.source.attack??null,w=l.source.rangedAttack??null;if(l.source.attack!==null&&l.source.attack!==void 0?(f=X(i),g=p.at,h=l.source.attack-f-g):l.source.rangedAttack!==null&&l.source.rangedAttack!==void 0&&(f=X(s),g=p.fk,h=l.source.rangedAttack-f-g),h===void 0)continue;const _=Math.max(6,Math.round(h));a.push({weaponName:l.source.name,combatTechniqueId:m,combatTechniqueName:d,derivedValue:_,sourceAttack:k,sourceRangedAttack:w,attributeBonus:f,weaponModifier:g,fallback:l.fallback}),c(m,d,h,l.source.name)}return{values:Object.fromEntries(Array.from(o.entries()).map(([l,m])=>[l,m.value])),warnings:r,details:a}}const he="1.5.1",ge=3,be=1100,B="1.0.0",ve="EL_1",Ae="R_1",ke="C_1",we="P_1",ye="m",Ee="Unbekannt",Te="Unbekannt",$e="Unbekannt",Le="Unbekannt",Se="Unbekannt",ze="Unbekannt",Ie=2,Ne="Unbekannt",Re={MU:"ATTR_1",KL:"ATTR_2",IN:"ATTR_3",CH:"ATTR_4",FF:"ATTR_5",GE:"ATTR_6",KO:"ATTR_7",KK:"ATTR_8"};function _e({dataset:n,parsed:e,resolved:t}){if(n.manifest.schemaVersion!==B)throw new Error(`Unsupported dataset schema version: ${n.manifest.schemaVersion}. Expected ${B}.`);const i=new Date().toISOString(),s=We(),a=Me(e),r=Oe(t),o=Pe(t),c=U(t.spells),u=U(t.liturgies),l=U(t.rituals),m=pe(e,t,n),p={clientVersion:he,dateCreated:i,dateModified:i,id:s,phase:ge,locale:n.manifest.locale,name:t.name,ap:{total:be},el:ve,r:Ae,c:ke,p:we,sex:Ce(e),pers:Ve(),attr:a,activatable:r,talents:o,spells:c,liturgies:u,blessings:Ke(t),cantrips:qe(t),rituals:l,ct:m.values,belongings:Fe(t),rules:Ue(),pets:{}},d=De(e,t,m.warnings);return{hero:p,warnings:d}}function Ce(n){const e=n.model.name.trim().toLowerCase(),t=n.normalizedSource.toLowerCase();return["kriegerin","magierin","priesterin","jägerin","herrin","schamanin","meisterin","händlerin","frau "].some(a=>t.includes(a))?"f":["schamane","priester","magier","herr ","krieger"].some(a=>t.includes(a))?"m":e.endsWith("in")||e.endsWith("a")?"f":ye}function Me(n){return{values:Object.entries(Re).map(([t,i])=>{const s=n.model.attributes[t]??0;return{id:i,value:typeof s=="number"?s:0}}).sort((t,i)=>t.id.localeCompare(i.id)),attributeAdjustmentSelected:"ATTR_4",ae:0,kp:0,lp:0,permanentAE:{lost:0,redeemed:0},permanentKP:{lost:0,redeemed:0},permanentLP:{lost:0}}}function Oe(n){const e={},t=(s,a)=>{e[s]||(e[s]=[]),e[s].push(a)},i=s=>{if(!s.match)return;const a={};s.selectOption&&(a.sid=s.selectOption.id),s.rawOption&&s.rawOption.trim()&&(a.options=[{type:"Custom",value:s.rawOption.trim()}]),s.level&&(a.tier=s.level),t(s.match.id,a)};return n.advantages.forEach(i),n.disadvantages.forEach(i),n.specialAbilities.forEach(i),n.combatSpecialAbilities.forEach(i),n.languages.forEach(s=>{if(!s.match)return;const a={};s.option&&(a.sid=s.option.optionId),!s.option&&s.rawOption?.trim()&&(a.options=[{type:"Custom",value:s.rawOption.trim()}]),s.level&&(a.tier=s.level),t(s.match.id,a)}),e}function Pe(n){const e={};for(const t of n.talents)t.match&&(e[t.match.id]=t.source.value);return e}function U(n){const e={};for(const t of n)t.match&&(e[t.match.id]=t.value);return e}function Ke(n){const e=new Set;for(const t of n.blessings)t.match&&e.add(t.match.id);return Array.from(e)}function De(n,e,t=[]){const i=[];for(const s of n.warnings)i.push(`[Parser] ${s.section??"general"}: ${s.message}`);for(const s of e.warnings)i.push(`[Resolver] ${s.section}: ${s.message}`);for(const[s,a]of Object.entries(e.unresolved))for(const r of a)i.push(`[Resolver] ${s}: unverarbeitet "${r}"`);if(e.weapons.forEach(s=>{!s.match&&s.fallback!=="unarmed"&&i.push(`[Exporter] weapons: Waffe "${s.source.name}" konnte nicht exportiert werden (keine Zuordnung).`)}),e.armor&&!e.armor.match&&!e.armor.isNaturalArmor){const s=e.armor.source.description??e.armor.source.notes??e.armor.source.raw;i.push(`[Exporter] armor: Rüstung "${s}" konnte nicht exportiert werden (keine Zuordnung).`)}return t.forEach(s=>i.push(s)),i}function qe(n){return n.specialAbilities.filter(e=>e.match?.id.startsWith("CANTRIP_")).map(e=>e.match.id)}function Ue(){return{higherParadeValues:0,attributeValueLimit:!1,enableAllRuleBooks:!0,enabledRuleBooks:[],enableLanguageSpecializations:!1}}function Ve(n){return{family:Ee,placeofbirth:Te,dateofbirth:$e,age:Le,size:Se,weight:ze,socialstatus:Ie,cultureAreaKnowledge:Ne}}function Fe(n){const e=[],t=s=>{e.push(s)};n.weapons.forEach(s=>{if(!s.match)return;const a=V(s.match,{name:s.source.name});s.combatTechnique?.id&&(a.combatTechnique=s.combatTechnique.id),t(a)}),n.armor?.match&&t(V(n.armor.match,{name:n.armor.source.description??n.armor.source.notes??n.armor.source.raw??n.armor.match.name})),n.equipment.forEach(s=>{s.match&&t(V(s.match,{name:s.source}))});const i={};return e.forEach((s,a)=>{const r=`ITEM_${a+1}`;i[r]={id:r,...s}}),{items:i,armorZones:{},purse:{d:"0",s:"0",h:"0",k:"0"}}}function V(n,e={}){const t=n.base??{},i=t.special??{},s={template:n.id,amount:1,name:n.name,isTemplateLocked:!0,...e};for(const[o,c]of Object.entries(t))o==="special"||o==="id"||c===void 0||(s[o]=c);const a={};for(const[o,c]of Object.entries(i??{}))if(c!=null)switch(o){case"protection":s.pro=c;break;case"encumbrance":s.enc=c;break;case"closeRange":a.close=Number(c);break;case"mediumRange":a.medium=Number(c);break;case"farRange":a.far=Number(c);break;default:s[o]=c;break}const r=[a.close,a.medium,a.far].filter(o=>typeof o=="number"&&Number.isFinite(o));return r.length>0&&(s.range=r),e.name?s.name=e.name:s.name=n.name,e.amount&&(s.amount=e.amount),s}function We(){return`H_${Math.floor(1+Math.random()*9e9)}`}const je={"schlechte eigenschaften":"Schlechte Eigenschaft","schlechte eigenschaft":"Schlechte Eigenschaft",dammerungssicht:"Dunkelsicht",dammersicht:"Dunkelsicht",dunkesicht:"Dunkelsicht",verpflichtung:"Verpflichtungen",personlichkeitsschwache:"Persönlichkeitsschwächen",personlichkeitsschwachen:"Persönlichkeitsschwächen"},xe=/AKO(?:[IVXLCDM]+)?\s*\d{1,4}/g,Xe=/[,:;]+$/,Be={peitsche:"fuhrmannspeitsche",speer:"speer",schwert:"langschwert",langschild:"gro schild",schild:"holzschild",dolch:"dolch",krummsabel:"sabel",krummsaebel:"sabel",platte:"plattenrustung"},Ze="belastungsgewohnung",He=["Arroganz","Eitelkeit","Neid","Streitsucht","Unheimlich","Verwöhnt","Vorurteile","Weltfremd","Anzügliches Verhalten","Eifersucht","Busenkomplexe","Peniskomplexe","Stimmungsschwankungen"],Ge=new Set(["ein","eine","einen","einem","einer","eins","zwei","drei","vier","fünf","sechs","sieben","acht","neun","zehn","elf","zwölf"].map(n=>n.toLowerCase()));function Ye(n,e){const t={lookups:e,warnings:[],unresolved:new Map,warningKeys:new Set},i=kt(n,e),s=new Set(i.languages),a=J([...n.specialAbilities,...At(n.notes)],s,e),r=J(n.combatSpecialAbilities,s,e),o=R(i.advantages,"advantages",t.lookups.advantages,t),c=R(i.disadvantages,"disadvantages",t.lookups.disadvantages,t),u=R(a,"specialAbilities",t.lookups.specialAbilities,t),l=R(r,"combatSpecialAbilities",t.lookups.specialAbilities,t),m=[...n.languages,...s],p=nt(m,t),d=Qe(n.talents,t),h=F(n.spells,"spells",t.lookups.spells,t),f=F(n.liturgies,"liturgies",t.lookups.liturgies,t),g=F(n.rituals,"rituals",t.lookups.spells,t),k=R(n.blessings,"blessings",t.lookups.blessings,t),w=R(n.equipment,"equipment",t.lookups.equipment,t),_=Je(u),le=et(n.weapons,t),v=tt(n.armor??null,t,_),$={};for(const[A,C]of t.unresolved.entries())$[A]=Array.from(C.values());return{name:n.name,advantages:o,disadvantages:c,specialAbilities:u,combatSpecialAbilities:l,languages:p,talents:d,spells:h,liturgies:f,rituals:g,blessings:k,equipment:w,weapons:le,armor:v,unresolved:$,warnings:t.warnings}}function R(n,e,t,i){return n.map(s=>I(s)).filter(s=>s.length>0).map(s=>{const a=Q(s);let r=b(a.baseName),o=t.byName.get(r),c,u,l,m;if(!o&&a.options.length>0)for(const d of a.options){const h=`${a.baseName} (${d})`,f=b(h),g=t.byName.get(f);if(g){o=g,r=f,c=d;break}}if(o&&pt(o)&&a.options.length>0)for(const d of a.options){const h=dt(o,d);if(h){u=h,m=h.name;break}l||(l=d)}else a.options.length>0&&(m=c??a.options[0]);if(!m&&a.options.length>0&&(m=c??a.options[0]),!m&&c&&(m=c),!o&&e==="equipment"){const d=Z(s,"equipment",i,a.options);d&&(o=d)}const p=at(a.baseName,a.level,m);return!o&&e==="blessings"&&ut(p)?{source:p,normalizedSource:r,match:void 0,selectOption:u,level:a.level??void 0,rawOption:l}:(o||z(e,p,i),{source:p,normalizedSource:r,match:o,selectOption:u,level:a.level??void 0,rawOption:l})})}function F(n,e,t,i){const s=[];for(const a of n){const r=I(a.name);if(!r){z(e,a.name,i);continue}const o=b(r),c=t.byName.get(o);c||z(e,r,i),s.push({source:r,normalizedSource:o,match:c,value:a.value})}return s}function Qe(n,e){return n.map(t=>{const i=b(t.name);let s=e.lookups.skills.byName.get(i);if(!s){const a=bt(i,e.lookups.skills.byName,1);a?(s=a.entry,y({type:"fuzzy-match",section:"talents",value:t.name,message:`Talent "${t.name}" wurde als "${s.name}" interpretiert (Schreibweise korrigiert).`},e)):z("talents",t.name,e)}return{source:t,match:s}})}function Je(n){let e=0;for(const t of n){if(t.match?.normalizedName!==Ze)continue;const i=t.level??1;i>e&&(e=i)}return e}function et(n,e){const t=[];for(const i of n){const s=I(i.name),a=b(s.length>0?s:i.name),r=i.category==="unarmed"||a==="waffenlos";let o=a.length>0?e.lookups.equipment.byName.get(a):void 0,c,u;if(o||(o=Z(i.name,"weapons",e)),!o&&r&&(u="unarmed",c=e.lookups.combatTechniques.byId.get("CT_9"),c||y({type:"unresolved",section:"combatTechniques",value:"CT_9",message:"Kampftechnik Raufen (CT_9) konnte nicht geladen werden."},e)),o){const l=mt(o);l?(c=e.lookups.combatTechniques.byId.get(l),c||y({type:"unresolved",section:"combatTechniques",value:l,message:`Kampftechnik-ID "${l}" fehlt im Datensatz (für ${i.name}).`},e)):u||y({type:"unresolved",section:"weapons",value:i.name,message:`Waffe "${i.name}" enthält keine Kampftechnik im Datensatz.`},e)}!o&&!u&&z("weapons",i.name,e),t.push({source:i,normalizedSource:a,match:o,combatTechnique:c,fallback:u})}return t}function tt(n,e,t){if(!n)return null;const s=(n.description??"").trim(),a=s.toLowerCase(),r=(n.notes??"").toLowerCase(),o=a.includes("keine")||a.includes("ohne"),c=(n.rs??0)>0||(n.be??0)>0||s.length>0,u=s.length===0||a.includes("natürlicher rüstungsschutz")||r.includes("natürlicher rüstungsschutz");if(!c||(n.rs??0)===0&&(n.be??0)===0&&o)return null;let l=s;s&&a.includes("normale kleidung")&&a.includes("oder nackt")&&(l="normale Kleidung");const m=I(l),p=m.length>0?b(m):void 0,d=p?e.lookups.equipment.byName.get(p):void 0;let h,f;if(d){const g=ft(d);if(h=g?.protection,f=g?.encumbrance,g||y({type:"unresolved",section:"armor",value:d.name,message:`Rüstung "${d.name}" enthält keine RS/BE-Daten im Optolith-Katalog.`},e),typeof n.rs=="number"&&typeof h=="number"&&n.rs!==h&&y({type:"value-mismatch",section:"armor",value:s||d.name,message:`RS (${n.rs}) weicht vom Optolith-Wert (${h}) ab.`},e),typeof n.be=="number"&&typeof f=="number"&&n.be!==f){const k=t*2;t>0&&n.be<f&&f-n.be<=k||y({type:"value-mismatch",section:"armor",value:s||d.name,message:`BE (${n.be}) weicht vom Optolith-Wert (${f}) ab.`},e)}}else{const g=s||`RS ${n.rs??"-"} / BE ${n.be??"-"}`;if(u){const k=s.length>0?s:`RS ${n.rs??"-"} / BE ${n.be??"-"}`,w=s.length>0?s:`RS ${n.rs??"-"} / BE ${n.be??"-"}`;y({type:"fuzzy-match",section:"armor",value:k,message:`Eintrag "${w}" ohne Rüstungsbeschreibung; vermutlich natürlicher Rüstungsschutz.`},e)}else z("armor",g,e)}return{source:n,normalizedSource:p,match:d,datasetProtection:h??null,datasetEncumbrance:f??null,isNaturalArmor:!d&&u}}function nt(n,e){return n.map(t=>I(t)).filter(t=>t.length>0).map(t=>{const i=st(t),s=b(i.baseName),a=e.lookups.languages.get(s);return a?(i.level&&a.maxLevel&&i.level>a.maxLevel&&y({type:"level-out-of-range",section:"languages",value:t,message:`Sprachstufe ${i.level} überschreitet den erlaubten Bereich (${a.maxLevel}).`},e),{source:t,normalizedSource:s,match:a.ability,option:a,level:i.level??void 0}):(z("languages",t,e),{source:t,normalizedSource:s,rawOption:i.baseName})})}function st(n){const e=n.trim(),t=e.match(/^(.*?)(?:\s+([IVX\d]+(?:\+[IVX\d]+)*))?$/i);if(!t)return{baseName:e};const i=(t[1]??e).trim(),s=t[2]?.trim();if(!s)return{baseName:i};const a=P(s);return{baseName:i,level:a??void 0}}function it(n){const e={I:1,V:5,X:10},t=n.toUpperCase().split("");let i=0,s=0;for(const a of t.reverse()){const r=e[a];if(!r)return null;r<s?i-=r:(i+=r,s=r)}return i}function O(n){const e=[[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]];let t=n,i="";for(const[s,a]of e)for(;t>=s;)i+=a,t-=s;return i||"I"}function at(n,e,t){const i=n.trim(),s=e?`${i} ${O(e)}`.trim():i;return t&&t.trim().length>0?`${s} (${t.trim()})`.trim():s}function P(n){const e=n.split("+").map(i=>i.trim()).filter(i=>i.length>0);if(e.length===0)return;const t=e.map(i=>{const s=Number.parseInt(i,10);return Number.isNaN(s)?it(i)??void 0:s}).filter(i=>i!==void 0);if(t.length!==0)return Math.max(...t)}function z(n,e,t){t.unresolved.has(n)||t.unresolved.set(n,new Set);const i=t.unresolved.get(n),s=i.size;i.add(e),i.size!==s&&y({type:"unresolved",section:n,value:e,message:`Eintrag "${e}" konnte im Abschnitt ${n} nicht aufgelöst werden.`},t)}function y(n,e){const t=`${n.type}:${n.section}:${n.value}:${n.message}`;e.warningKeys.has(t)||(e.warningKeys.add(t),e.warnings.push(n))}function Z(n,e,t,i=[]){const s=rt(n,t.lookups.equipment,i);if(!s)return;const a=lt(e,n,s.match.name,s);return y({type:"fuzzy-match",section:e,value:n,message:a},t),s.match}function rt(n,e,t){const i=b(n),s=ot(n,t);for(const a of s){const r=b(a);if(!r||r===i)continue;const o=e.byName.get(r);if(o)return{match:o,token:a,reason:"token"}}for(const a of s){const r=b(a);if(r){for(const[o,c]of Object.entries(Be))if(r===o||r.includes(o)){const u=e.byName.get(c);if(u)return{match:u,token:a,reason:"keyword",keyword:o}}}}}function ot(n,e){const t=new Set,i=a=>{if(!a)return;const r=a.trim();if(r.length===0)return;const o=Y(G(r));H(t,o),o!==r&&H(t,r)};i(n);const s=n.replace(/[()]/g," ");return s.split(/[-–—\/]/).forEach(a=>{i(a),a.split(/[,&]/).forEach(r=>i(r))}),s.split(/[,&]/).forEach(a=>i(a)),s.split(/\s+/).forEach(a=>i(a)),e.forEach(a=>i(a)),Array.from(t.values())}function H(n,e){if(e){n.has(e)||n.add(e);for(const t of ct(e))t.length>0&&n.add(t)}}function ct(n){const e=new Set,t=n.trim(),i=t.toLowerCase();if(i.length<=2)return[];const s=r=>{r&&r!==t&&e.add(r)},a=(r,o="")=>{i.endsWith(r)&&t.length>r.length+1&&s(t.slice(0,t.length-r.length)+o)};return a("en"),a("en","e"),a("e"),a("er"),a("n"),a("s"),Array.from(e.values())}function lt(n,e,t,i){const s=n==="weapons"?"Waffe":"Ausrüstungseintrag";if(i.reason==="keyword"){const a=i.keyword??i.token;return`${s} "${e}" wurde als "${t}" interpretiert (Schlüsselwort "${a}").`}return`${s} "${e}" wurde als "${t}" interpretiert (Teilbegriff "${i.token}").`}function ut(n){const e=b(n);return e==="die zwolf segnungen"||e==="zwolf segnungen"||e==="12 segnungen"}function mt(n){const e=n.base;if(!e||typeof e!="object")return;const t=e.special;if(!t||typeof t!="object")return;const i=t.combatTechnique;return typeof i=="string"?i:void 0}function ft(n){const e=n.base;if(!e||typeof e!="object")return;const t=e.special;if(!t||typeof t!="object")return;const i=t.protection,s=t.encumbrance;if(!(typeof i!="number"&&typeof s!="number"))return{protection:typeof i=="number"?i:null,encumbrance:typeof s=="number"?s:null}}function dt(n,e){const t=n.locale,i=Array.isArray(t?.selectOptions)?t.selectOptions:[],s=b(e);for(const a of i){if(typeof a?.name!="string"||typeof a?.id!="number")continue;if(b(a.name)===s)return{id:a.id,name:a.name}}}function pt(n){const e=n.locale;return Array.isArray(e?.selectOptions)&&e.selectOptions.length>0}function I(n){if(!n)return n;const a=n.replace(xe," ").replace(/\(\s*\)/g,"").replace(/\s*\+\s*/g,"+").replace(/\s+/g," ").trim().replace(Xe,"").trim();return gt(ht(a))}function ht(n){return n.replace(/(Tradition\s*\()([^)]*?)geweih(?:ter|te|ten)(\))/gi,(e,t,i,s)=>{const a=i.trim().replace(/[-\s]+$/g,"");if(!a)return`${t}${i}${s}`;const r=`${a}kirche`;return`${t}${r}${s}`})}function gt(n){const e={analys:"Analys Arkanstruktur",odem:"Odem Arcanum",zauberklinge:"Zauberklinge Geisterspeer"},t=b(n);return e[t]??n}function G(n){const e=n.trim(),t=e.match(/^(\d+)\s+(.*)$/u);if(t&&t[2])return t[2].trim();const i=e.match(/^([A-Za-zÄÖÜäöüß]+)\s+(.*)$/u);if(i&&i[2]){const s=i[1]?.toLowerCase();if(s&&Ge.has(s))return i[2].trim()}return e}function Y(n){return n.replace(/\(\s*(?:x\s*)?\d+\s*\)\s*$/iu,"").trim()}function Q(n){let e=n.trim();e=Y(G(e)),e=e.replace(/([IVX]+)\s*-\s*([IVX]+)/gi,"$1+$2");let t;const i=[],s=()=>{const r=e.match(/\s+([IVX\d]+(?:\+[IVX\d]+)*)$/i);r&&(t=r[1]?.trim(),e=e.slice(0,r.index).trim())};for(s();;){const r=e.match(/\(([^)]+)\)\s*$/);if(!r)break;const o=r[1]?.trim();if(o){const c=o.split(/[,;]/).map(u=>u.trim()).filter(u=>u.length>0);if(c.length===0)i.unshift(o);else for(let u=c.length-1;u>=0;u-=1){const l=c[u];l&&i.unshift(l)}}e=e.slice(0,r.index).trim()}t||s();const a=t?P(t):void 0;return{baseName:e,options:i,level:a??void 0}}function bt(n,e,t){let i;for(const[s,a]of e.entries()){if(Math.abs(s.length-n.length)>t)continue;const r=vt(s,n,t);if(r!==void 0&&(!i||r<i.distance)&&(i={entry:a,normalized:s,distance:r},r===0))return i}return i}function vt(n,e,t){const i=n.length,s=e.length;if(Math.abs(i-s)>t)return;if(i===0)return s<=t?s:void 0;if(s===0)return i<=t?i:void 0;const a=Array.from({length:s+1},(c,u)=>u),r=new Array(s+1);for(let c=1;c<=i;c+=1){r[0]=c;let u=r[0];const l=n.charAt(c-1);for(let m=1;m<=s;m+=1){const p=l===e.charAt(m-1)?0:1;r[m]=Math.min(a[m]+1,r[m-1]+1,a[m-1]+p),u=Math.min(u,r[m])}if(u>t)return;a.splice(0,a.length,...r)}const o=a[s];return o<=t?o:void 0}function J(n,e,t){const i=[];for(const s of n){const a=I(s);if(/^muttersprache\b/i.test(a)){e.add(ee(a));continue}const r=Q(a),o=b(r.baseName);if(t.languages.get(o)??t.scripts.get(o)){r.level!==void 0?e.add(`${r.baseName} ${O(r.level)}`):e.add(r.baseName);continue}i.push(s)}return i}function At(n){const e=new Set;for(const t of Object.values(n)){if(!t)continue;const i=t.split(/;+/);for(const s of i){const a=s.trim();if(!a)continue;const r=a.match(/^Paktgeschenke?:\s*(.+)$/i);if(r){const o=r[1]?.trim();o&&e.add(o)}}}return Array.from(e)}function kt(n,e){const t=new Set,i=new Set,s=new Set,a=(r,o)=>{const c=I(r);if(!c)return;if(/^muttersprache\b/i.test(c)){const l=ee(c);s.add(l);return}const u=wt(c);for(const l of u){const{label:m,baseLabel:p,detail:d}=$t(l),h=b(p);let f=e.advantages.byName.get(h),g=e.disadvantages.byName.get(h);if(!f&&!g&&d){const w=b(`${p} (${d})`);f=e.advantages.byName.get(w),g=e.disadvantages.byName.get(w)}if(f&&!g){t.add(m);continue}if(g&&!f){i.add(m);continue}if(f&&g){o==="advantage"?t.add(m):i.add(m);continue}const k=It(m);if(k==="advantage"){t.add(m);continue}if(k==="disadvantage"){i.add(m);continue}o==="advantage"?t.add(m):i.add(m)}};for(const r of n.advantages)a(r,"advantage");for(const r of n.disadvantages)a(r,"disadvantage");return{advantages:Array.from(t),disadvantages:Array.from(i),languages:Array.from(s)}}function wt(n){const e=Tt(n),t=[];for(const i of e){const s=Et(i);if(s){t.push(s);continue}t.push(yt(i))}return Array.from(new Set(t))}function yt(n){const e=n.match(/^Immunität gegen\s+([^()]+)$/i);if(e&&e[1]){const t=e[1].trim();if(t.length>0)return`Immunität gegen (${t})`}return n}function Et(n){if(/^persönlichkeitsschwäche\b/i.test(n))return n.replace(/^persönlichkeitsschwäche/i,"Persönlichkeitsschwächen");if(/^persönlichkeitsschwächen\b/i.test(n))return n;const e=n.trim();if(!e)return;const t=e.toLowerCase();for(const i of He){const s=i.toLowerCase();if(t===s||t.startsWith(`${s} `))return`Persönlichkeitsschwächen (${e})`}}function Tt(n){const e=n.trim(),t=e.match(/^Angst vor\b(.*)$/i);if(!t)return[e];const i=t[1]?.trim()??"";if(!i)return["Angst vor"];let s=i;if(s.startsWith("(")&&s.endsWith(")"))s=s.slice(1,-1).trim();else{const r=s.match(/\(([^)]+)\)/);r&&r[1]?s=r[1].trim():s=s.trim()}if(s=s.replace(/^…\s*/u,""),!s)return["Angst vor"];const a=s.split(/[,;/]/).map(r=>r.trim().replace(/^…\s*/u,"").replace(/^\(+/u,"").replace(/\)+$/u,"").trim()).filter(r=>r.length>0);return a.length===0?[`Angst vor (${s})`]:a.map(r=>`Angst vor (${r})`)}function $t(n){let e=n.trim();e=e.replace(/([IVX]+)\s*-\s*([IVX]+)/gi,"$1+$2");const t=e.match(/\s+([IVX\d]+(?:\+[IVX\d]+)*)$/i);let i;t&&(i=t[1],e=e.slice(0,t.index).trim());let s;const a=e.match(/^Angst vor\s+(.+)$/i);if(a){const l=a[1]?.trim();l&&!l.startsWith("(")&&(s=l,e="Angst vor")}const r=e.match(/\s*\(([^)]+)\)\s*$/);if(r&&(s=r[1],e=e.slice(0,r.index).trim()),!i){const l=e.match(/\s+([IVX\d]+(?:\+[IVX\d]+)*)$/i);l&&(i=l[1],e=e.slice(0,l.index).trim())}const o=Lt(e);let c=o;const u=i?P(i):void 0;return u&&(c=`${c} ${O(u)}`.trim()),s&&(c=`${c} (${s})`.trim()),{label:c,baseLabel:o,detail:s}}function ee(n){let e=n.replace(/^muttersprache/i,"").trim();if(!e)return"Garethi III";const t=e.match(/([IVX\d]+)$/i);let i;t&&(i=t[1],e=e.slice(0,t.index).trim());const s=P(i??"III")??3;return`${e} ${O(s)}`.trim()}function Lt(n){const e=b(n);return je[e]??n}const St=["beidhändig","dunkelsicht","richtungssinn","entfernungssinn","zauberer","zäher hund","blutrausch","herausragender sinn","giftresistenz"],zt=["schlechte eigenschaft","eingeschränkter sinn","angst vor","blind","kälteempfindlich","zauberanfällig"];function It(n){const e=b(n);return St.some(t=>e.includes(t))?"advantage":zt.some(t=>e.includes(t))?"disadvantage":"unknown"}const Nt=/^(MU|KL|IN|CH|FF|GE|KO|KK)(\s+\d{1,2})\s+(MU|KL|IN|CH|FF|GE|KO|KK)/,te=/([A-Za-zÄÖÜäöüß/+\-]+)\s+([^\s]+)/g,ne=/^([A-Za-zÄÖÜäöüß0-9\s/+\-&]+):\s*(.*)$/,Rt=["MU","KL","IN","CH","FF","GE","KO","KK"],_t={vorteile:"advantages",nachteile:"disadvantages",sonderfertigkeiten:"specialAbilities",kampfsonderfertigkeiten:"combatSpecialAbilities",kampfsonderfertigkeit:"combatSpecialAbilities",sprachen:"languages",talente:"talents",rsbe:"armor",aktionen:"actions",liturgien:"liturgies",liturgie:"liturgies",zauber:"spells",zaubersprüche:"spells",zaubertricks:"spells",rituale:"rituals",rituellezauber:"rituals",ausrüstung:"equipment",gegenstände:"equipment",inventar:"equipment",segnungen:"blessings",kampfverhalten:"notes",kampfverhaltenundflucht:"notes",flucht:"notes",schmerz:"notes","vorteile/nachteile":"advantages-disadvantages",vorteilenachteile:"advantages-disadvantages"},Ct={sinesschärfe:"Sinnesschärfe","angriff verbessern":"Attacke verbessern",schnelladen:"Schnellladen",eigne:"Eigene"},Mt={MU:"Mut",KL:"Klugheit",IN:"Intuition",CH:"Charisma",FF:"Fingerfertigkeit",GE:"Gewandheit",KO:"Konstitution",KK:"Körperkraft"},Ot=new Set(["ein","eine","einen","einem","einer","eins","zwei","drei","vier","fünf","sechs","sieben","acht","neun","zehn","elf","zwölf"].map(n=>n.toLowerCase()));function Pt(n){const e=[],t=Kt(n),i=t.split(`
`).map(v=>v.trim()).filter(v=>v.length>0);if(i.length===0)return{model:on(),warnings:[{type:"parse-error",message:"Eingabetext ist leer."}],normalizedSource:t};const s=[...i],a=s.shift()??"Unbekannt",r=[];for(;s.length>0;){const v=s[0];if(!v||!Nt.test(v))break;r.push(s.shift())}const o=Dt(r.join(" "),e),c={},u=s[0];u?.startsWith("LeP")?(W(u,c),s.shift()):e.push({type:"missing-section",section:"resources",message:"LeP/AsP/KaP-Zeile nicht gefunden."});const l=s[0];l?.startsWith("AW")&&(W(l,c),s.shift()),qt(s,c);const m=[];for(;s.length>0;){const v=s[0];if(!v||!se(v))break;s.shift();const $=[v];for(;s.length>0&&Ut(s[0]);)$.push(s.shift());const A=$.join(" ").replace(/\s+/g," ").trim(),C=Ft(A,e);C&&m.push(C)}const p=[...s],{sections:d,extras:h}=jt(p),f={advantages:[],disadvantages:[],specialAbilities:[],combatSpecialAbilities:[],languages:[],talents:[],spells:[],liturgies:[],rituals:[],blessings:[],equipment:[]},g=new Set,k={};let w=null,_;for(const v of d){const $=xt(v.heading),A=M(v.content);if(!$){k[v.heading]=A;continue}switch(g.add($),$){case"advantages":L(f.advantages,A);break;case"disadvantages":L(f.disadvantages,A);break;case"advantages-disadvantages":g.add("advantages"),g.add("disadvantages"),A.toLowerCase()!=="keine"&&Ht(f,A);break;case"specialAbilities":{const{primary:C,trailing:ue}=sn(A,"Talente:");ie(f.specialAbilities,C),ue&&ae(f.talents,ue);break}case"combatSpecialAbilities":ie(f.combatSpecialAbilities,A);break;case"languages":L(f.languages,A);break;case"talents":ae(f.talents,A);break;case"spells":L(f.spells,A);break;case"liturgies":L(f.liturgies,A);break;case"rituals":L(f.rituals,A);break;case"blessings":L(f.blessings,A);break;case"equipment":L(f.equipment,A);break;case"armor":w=Vt(A,e);break;case"actions":_=N(A);break;case"notes":default:k[v.heading]=A;break}}for(const v of["advantages","disadvantages","specialAbilities","talents"])g.has(v)||e.push({type:"missing-section",section:v,message:`Abschnitt "${v}" nicht gefunden.`});return{model:{name:a,attributes:o,pools:c,armor:w,actions:_??null,weapons:m,advantages:S(f.advantages),disadvantages:S(f.disadvantages),specialAbilities:S(f.specialAbilities),combatSpecialAbilities:S(f.combatSpecialAbilities),languages:S(f.languages),spells:j(f.spells,"spells",e),liturgies:j(f.liturgies,"liturgies",e),rituals:j(f.rituals,"rituals",e),blessings:S(f.blessings),equipment:Bt(f.equipment),talents:an(f.talents,e),notes:k,extras:h},warnings:e,normalizedSource:t}}function Kt(n){let e=n.replace(/\r\n/g,`
`).replace(/\t/g," ");return e=e.replace(/([A-Za-zÄÖÜäöüß])-\s*\n\s*([A-Za-zÄÖÜäöüß])/g,"$1$2"),e=e.replace(/–/g,"-"),e=e.split(`
`).map(t=>t.trimEnd()).join(`
`),e.trim()}function Dt(n,e){const t={};if(!n)return e.push({type:"missing-section",section:"attributes",message:"Eigenschaftszeilen nicht gefunden."}),t;const i=/(MU|KL|IN|CH|FF|GE|KO|KK)\s+(\d{1,2})/g;let s;for(;(s=i.exec(n))!==null;){const a=s[1],r=s[2];if(!a||!r)continue;const o=a,c=Number.parseInt(r,10);t[o]=Number.isNaN(c)?void 0:c}for(const a of Rt)t[a]===void 0&&e.push({type:"parse-error",section:"attributes",message:`Eigenschaft ${a} konnte nicht gelesen werden.`});return t}function W(n,e){for(const t of n.matchAll(te)){const i=t[1],s=t[2];if(!i||!s)continue;const a=N(s);switch(i){case"LeP":e.lep=a;break;case"AsP":e.asp=a;break;case"KaP":e.kap=a;break;case"INI":e.ini=s;break;case"AW":e.aw=a;break;case"SK":e.sk=a;break;case"ZK":e.zk=a;break;case"GS":e.gs=a;break}}}function qt(n,e){for(;n.length>0;){const t=n[0]?.trim()??"";if(!t){n.shift();continue}const i=t.replace(/^[–—-]\s*/,"").trim();if(!/^(LeP|AsP|KaP|INI|AW|SK|ZK|GS)\b/i.test(i))break;n.shift(),W(i,e)}}function N(n){const e=n.replace(/[^0-9\-]/g,"");if(!e)return null;const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}function se(n){return/^[^:]+:\s+(AT|FK)\s+/i.test(n)}function Ut(n){if(!n)return!1;const e=n.trim();return!(!e||se(e)||ne.test(e)||/^RS\s*\/\s*BE/i.test(e))}function Vt(n,e){const t=M(n);if(!t)return null;const i=t,s=t.match(/^(\d+)\s*\/\s*(\d+)(.*)$/);if(!s)return e.push({type:"parse-error",section:"armor",message:`Rüstungseintrag "${t}" konnte nicht interpretiert werden.`}),{rs:null,be:null,description:null,notes:t,raw:i};const[,a,r,o=""]=s,c=o??"",u=[...c.matchAll(/\(([^)]+)\)/g)].map(p=>p[1]?.trim()??"");let l=u[0]??null;const m=u.length>1?u.slice(1).filter(Boolean).join("; "):null;if(!l){const p=c.replace(/\([^)]*\)/g," ").replace(/[;,]+/g," ").trim();p&&(l=M(p))}return{rs:N(a??""),be:N(r??""),description:l,notes:m,raw:i}}function Ft(n,e){const[t,i]=n.split(":");if(!i){e.push({type:"parse-error",section:"weapons",message:`Zeile "${n}" enthält keinen Doppelpunkt.`});return}const s=(t??"").trim(),a={};for(const l of i.matchAll(te)){const m=l[1],p=l[2];if(!m||!p)continue;const d=m.toUpperCase();a[d]=p}const r=a.AT?N(a.AT):null,o=a.PA?N(a.PA):null,c=a.FK?N(a.FK):null,u=Wt(s,r,c);return{name:s,category:u,attack:r,parry:o,rangedAttack:c,damage:a.TP??null,range:a.RW??null,load:a.LZ??null,reach:a.RE??null,notes:a.BEM??null,raw:a,rawInput:n.trim()}}function Wt(n,e,t){return n.toLowerCase().includes("waffenlos")?"unarmed":t!==null?"ranged":e!==null?"melee":"unknown"}function jt(n){const e=[],t=[];let i=null,s=[];const a=()=>{i?e.push({heading:i,content:s.join(" ").trim()}):s.length>0&&t.push(s.join(" ").trim()),i=null,s=[]};for(const r of n){const o=r.trim();if(!o)continue;const c=o.match(ne);if(c){a();const u=c[1]?.trim();i=u&&u.length>0?u:null;const l=c[2]?.trim();s=l?[l]:[];continue}i?s.push(o):t.push(o)}return a(),{sections:e,extras:t}}function xt(n){const e=n.toLowerCase().replace(/\s+/g,"").replace(/[()\/]/g,"");return e.startsWith("schmerz")||e==="kampfverhaltenflucht"?"notes":_t[e]??null}function L(n,e){if(e)for(const t of K(e))n.push(t)}function ie(n,e){if(e)for(const t of K(e))Zt(t).forEach(s=>{s&&n.push(s)})}function ae(n,e){if(!(!e||e.toLowerCase()==="keine"))for(const t of K(e))n.push(t)}function K(n){const e=[];let t="",i=0;for(const a of n){if(a==="("?i+=1:a===")"&&(i=Math.max(i-1,0)),(a===","||a===";")&&i===0){t.trim()&&e.push(t.trim()),t="";continue}t+=a}t.trim()&&e.push(t.trim());const s=e.map(a=>D(a));return Xt(s)}function Xt(n){const e=[];for(const t of n){const i=t.trim();e.length>0&&/^(den|die|das|dessen|deren)\b/i.test(i)?e[e.length-1]=`${e[e.length-1]}, ${i}`:e.push(i)}return e}function Bt(n){return S(n).map(e=>en(Jt(e))).filter(e=>e.length>0)}function Zt(n){const e=n.split(new RegExp("(?<=\\))\\s+(?=[A-ZÄÖÜ][a-zäöüß])","u")).map(t=>t.trim()).filter(t=>t.length>0);return e.length>0?e:[n]}function Ht(n,e){for(const t of K(e)){const i=nn(t);for(const s of i){const a=Gt(s);a==="disadvantage"?n.disadvantages.push(s):a==="advantage"?n.advantages.push(s):(n.advantages.push(s),n.disadvantages.push(s))}}}function Gt(n){const e=n.toLowerCase();return["schlechte eigenschaft","verpflicht","feindschaft","hass","arm","krankheit","unfähig","vorurteil","schulden","angst","zauberanfällig"].some(s=>e.includes(s))?"disadvantage":["begabung","adelig","gutaussehend","vorteil","resistenz","richtungssinn","entfernungssinn"].some(s=>e.includes(s))?"advantage":"both"}function S(n){return n.map(e=>M(e)).map(e=>D(e)).map(e=>Yt(e)).map(e=>Qt(e)).map(e=>re(e)).map(e=>oe(e)).map(e=>M(e)).map(e=>e.endsWith(".")?e.slice(0,-1):e).filter(e=>e.length>0).filter(e=>{const t=e.toLowerCase();return t!=="keine"&&t!=="keiner"&&t!=="keinen"&&t!=="entfällt"})}function M(n){return n.replace(/\s+/g," ").trim()}function D(n){return n.replace(/([A-Za-zÄÖÜäöüß])-\s+([A-Za-zÄÖÜäöüß])/g,"$1$2")}function Yt(n){let e=n.replace(/([IVX]+)\s*AKO\d+/gi,"$1").replace(/([IVX]+)AKO\d+/gi,"$1");return e=e.replace(/AKO[IVX\d]+/gi,""),e=e.replace(/\s{2,}/g," "),e.trim()}function re(n){let e=n;for(const[t,i]of Object.entries(Ct)){const s=new RegExp(`\\b${t}\\b`,"gi");e=e.replace(s,i)}return e}function oe(n){return n.replace(/\*+$/g,"").trim()}function Qt(n){return n.replace(/\(([^)]+)\)/g,(e,t)=>`(${t.split(/\s*[;,\/]\s*/).map(s=>{const a=s.trim(),r=a.toUpperCase();return Mt[r]??a}).filter(s=>s.length>0).join(", ")})`)}function Jt(n){const e=n.trim(),t=e.match(/^(\d+)\s+(.*)$/u);if(t&&t[2])return t[2].trim();const i=e.match(/^([A-Za-zÄÖÜäöüß]+)\s+(.*)$/u);if(i&&i[2]){const s=i[1]?.toLowerCase();if(s&&Ot.has(s))return i[2].trim()}return e}function en(n){let e=n.trim();return e=e.replace(/\(\s*(?:x\s*)?\d+\s*\)\s*$/iu,"").trim(),e}function tn(n){return n.replace(/\(\s*[^)]*\)\s*$/u,"").trim()}function nn(n){const e=[];let t="",i=0;for(const s of n){if(s==="("?i+=1:s===")"&&(i=Math.max(i-1,0)),s==="/"&&i===0){t.trim()&&e.push(t.trim()),t="";continue}t+=s}return t.trim()&&e.push(t.trim()),e}function sn(n,e){const t=n.toLowerCase(),i=e.toLowerCase(),s=t.indexOf(i);if(s===-1)return{primary:n};const a=n.slice(0,s).trim().replace(/[;,]+$/,""),r=n.slice(s+e.length).trim();return{primary:a.length>0?a:"",trailing:r.length>0?r:void 0}}function an(n,e){const t=[];for(const i of n){const a=oe(i.trim()).match(/^(.+?)\s+(-?\d+)$/);if(!a){e.push({type:"parse-error",section:"talents",message:`Talent konnte nicht interpretiert werden: "${i}"`});continue}const r=D(a[1]??""),o=a[2];if(!r||!o){e.push({type:"parse-error",section:"talents",message:`Talent konnte nicht interpretiert werden: "${i}"`});continue}const c=re(r.replace(/\*+$/,"").trim()),u=Number.parseInt(o,10);if(Number.isNaN(u)){e.push({type:"parse-error",section:"talents",message:`Talentwert ist keine Zahl: "${i}"`});continue}t.push({name:c,value:u})}return t}function j(n,e,t){const i=[];for(const s of S(n)){const r=tn(s).match(/^(.+?)\s+(-?\d+|[IVX]+)$/i);if(!r){i.push({name:s,value:0}),t.push({type:"parse-error",section:e,message:`Wert für ${e} konnte nicht ermittelt werden: "${s}"`});continue}const o=D(r[1]??""),c=r[2];if(!o||!c){t.push({type:"parse-error",section:e,message:`Wert für ${e} konnte nicht ermittelt werden: "${s}"`});continue}const u=o.trim(),l=c.trim();let m=Number.parseInt(l,10);if(Number.isNaN(m)&&(m=rn(l.toUpperCase())),!m||Number.isNaN(m)){t.push({type:"parse-error",section:e,message:`Numerischer Wert für ${e} ist ungültig: "${s}"`});continue}i.push({name:u,value:m})}return i}function rn(n){const e={I:1,V:5,X:10,L:50,C:100},t=n.toUpperCase().split("");let i=0,s=0;for(const a of t.reverse()){const r=e[a];if(!r)return null;r<s?i-=r:(i+=r,s=r)}return i}function on(){return{name:"Unbekannt",attributes:{},pools:{},armor:null,actions:null,weapons:[],advantages:[],disadvantages:[],specialAbilities:[],combatSpecialAbilities:[],languages:[],spells:[],liturgies:[],rituals:[],blessings:[],equipment:[],talents:[],notes:{},extras:[]}}let q,ce;self.addEventListener("message",async n=>{const e=n.data;if(!(!e||e.type!=="convert"))try{const t=await cn(e.payload.baseUrl),i=Pt(e.payload.source),s=Ye(i.model,t),{hero:a,warnings:r}=_e({dataset:t,parsed:i,resolved:s}),o=ln(s),c={type:"result",payload:{exported:a,exportedWarnings:r,manifest:t.manifest,normalizedSource:i.normalizedSource,parserWarnings:i.warnings,resolverWarnings:s.warnings,unresolved:s.unresolved,equipmentSummary:o}};postMessage(c)}catch(t){const i={type:"error",error:t instanceof Error?t.message:String(t)};postMessage(i)}});async function cn(n){const e=new URL("data/optolith/manifest.json",n).toString();if(q&&ce===e)return q;const t=await fetch(e);if(!t.ok)throw new Error(`Manifest konnte nicht geladen werden (${t.status})`);const i=await t.json(),s=async r=>{const o=new URL(`data/optolith/${r}`,n).toString(),c=await fetch(o);if(!c.ok)throw new Error(`Datensatz ${r} konnte nicht geladen werden (${c.status})`);return c.json()},a={manifest:i,advantages:await s(T(i,"advantages")),disadvantages:await s(T(i,"disadvantages")),specialAbilities:await s(T(i,"specialAbilities")),skills:await s(T(i,"skills")),combatTechniques:await s(T(i,"combatTechniques")),spells:await s(T(i,"spells")),liturgies:await s(T(i,"liturgies")),blessings:await s(T(i,"blessings")),equipment:await s(T(i,"equipment"))};return q=me(a),ce=e,q}function ln(n){const e=n.weapons.map(s=>({name:s.source.name,templateId:s.match?.id,combatTechniqueId:s.combatTechnique?.id,fallback:s.fallback,unresolved:!s.match})),t=n.armor?{name:n.armor.source.description??n.armor.source.notes??n.armor.source.raw??"Unknown armor",templateId:n.armor.match?.id,protection:typeof n.armor.datasetProtection=="number"?n.armor.datasetProtection:null,encumbrance:typeof n.armor.datasetEncumbrance=="number"?n.armor.datasetEncumbrance:null,unresolved:!n.armor.match}:null,i=n.equipment.map(s=>({name:s.source,templateId:s.match?.id,unresolved:!s.match}));return{weapons:e,armor:t,gear:i}}function T(n,e){const t=n.sections.find(i=>i.key===e);if(!t)throw new Error(`Manifestabschnitt fehlt: ${e}`);return t.file}})();
